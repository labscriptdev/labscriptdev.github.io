import"./matter.22d1f548.js";import{E as x}from"./extendedObject3D.dedb3aee.js";import"./three.module.792bc64d.js";import"./entry.8100cb04.js";class R extends x{constructor(e){super(),this.name="Car",this.game=e.game,this.position.set(e.x||0,e.y||0,e.z||0),this.carWidth=2,this.carDepth=4,this.carMass=100,this.axisDistanceBetween=4,this.wheelRadius=.4,this.maxEngineForce=400,this.maxBreakingForce=400,this.suspensionRestLength=.6,this.suspensionStiffness=10,this.suspensionDamping=.1,this.suspensionCompression=4.4,this.friction=50,this.rollInfluence=.01}preload(){return{mercedes:{type:"gltf",url:"/assets/threejs/models/vehicles/mercedes/scene.gltf"}}}onCreate(){this.carCreateVisual(),this.carCreatePhysics()}onUpdate(){this.carUpdate();const{camera:e}=this.game.getData();this.chassi.add(e),e.position.set(0,2,-this.carDepth-2);const s=this.chassi.position.clone();e.lookAt(s)}getSpeed(){return this.vehicle.getCurrentSpeedKmHour()}carCreateVisual(){const{x:e,y:s,z:i}=this.position;this.chassi=this.meshCreate({type:"box",data:{x:e,y:s,z:i,width:this.carWidth,depth:this.carDepth,mass:5e3,height:.25},material:{lambert:{wireframe:!0}},physics:{mass:this.carMass},callback:n=>n}),this.wheels=[{x:-(this.carWidth/2),y:0,z:this.axisDistanceBetween/2},{x:this.carWidth/2,y:0,z:this.axisDistanceBetween/2},{x:-(this.carWidth/2),y:0,z:-(this.axisDistanceBetween/2)},{x:this.carWidth/2,y:0,z:-(this.axisDistanceBetween/2)}].map((n,o)=>this.meshCreate({type:"cylinder",data:{x:n.x,y:n.y,z:n.z,radiusBottom:this.wheelRadius,radiusTop:this.wheelRadius,radiusSegments:24,height:.35},material:{lambert:{color:0}},callback:a=>(a.geometry.center(),a)}))}carCreatePhysics(){this.position;const{physics:e}=this.game.getData(),{physicsWorld:s}=e,i=new Ammo.btVehicleTuning,n=new Ammo.btDefaultVehicleRaycaster(s),o=new Ammo.btRaycastVehicle(i,this.chassi.body.ammo,n);o.setCoordinateSystem(0,1,2),s.addAction(o),this.chassi.body.skipUpdate=!0,this.vehicle=o,this.wheels.forEach((a,c)=>{const r=c<=1,l=a.position.clone(),t=new Ammo.btVector3(l.x,l.y,l.z),p=new Ammo.btVector3(0,-1,0),m=new Ammo.btVector3(-1,0,0),h=o.addWheel(t,p,m,this.suspensionRestLength,this.wheelRadius,i,r);h.set_m_suspensionStiffness(this.suspensionStiffness),h.set_m_wheelsDampingRelaxation(this.suspensionDamping),h.set_m_wheelsDampingCompression(this.suspensionCompression),h.set_m_frictionSlip(this.friction),h.set_m_rollInfluence(this.rollInfluence)})}carUpdate(){const{input:e}=this.game.getData(),s=0,i=1,n=2,o=3;let a=0,c=0,r=.4,l=.8,t=0;e.w?a=this.maxEngineForce:e.s?a=-this.maxEngineForce:a=0,e.a?t<l&&(t+=r):e.d?t>-l&&(t-=r):(t>0&&(t-=r/2),t<0&&(t+=r/2),Math.abs(t)<=r&&(t=0)),e.space?c=this.maxBreakingForce:c=0,this.vehicle.applyEngineForce(a,n),this.vehicle.applyEngineForce(a,o),this.vehicle.setSteeringValue(t,s),this.vehicle.setSteeringValue(t,i),this.vehicle.setBrake(c/2,s),this.vehicle.setBrake(c/2,i),this.vehicle.setBrake(c,n),this.vehicle.setBrake(c,o),(()=>{this.wheels.forEach((g,y)=>{let f=this.vehicle.getWheelTransformWS(y),u=f.getOrigin(),d=f.getRotation();g.position.set(u.x(),u.y(),u.z()),g.quaternion.set(d.x(),d.y(),d.z(),d.w()),g.rotateZ(Math.PI/2)});let p=this.vehicle.getChassisWorldTransform(),m=p.getOrigin(),h=p.getRotation();this.chassi.position.set(m.x(),m.y(),m.z()),this.chassi.quaternion.set(h.x(),h.y(),h.z(),h.w())})()}meshCreate(e={}){const{physics:s}=this.game.getData();let i=s.factory.add[e.type](e.data,e.material);return typeof e.callback=="function"&&(i=e.callback(i)),typeof e.physics=="object"&&s.add.existing(i,e.physics||{}),i}}export{R as default};
