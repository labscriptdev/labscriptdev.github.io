import{s as r,v as n,x as i}from"./entry.a41c27f5.js";import"./lodash.a7a7ec87.js";class l{constructor(t={}){const{$dayjs:s}=r();this.ready=!1,this.date=t.date||s().startOf("month").format("YYYY-MM-DD"),this.storage=n("clockify",{token:"",amountPerHour:13,amountCurrency:"BRL",currencyFrom:"AUD",currencyTo:"BRL"}),this.user=!1,this.workspace={loading:!1,item:!1,items:[]},this.timeEntry={loading:!1,items:[]},this.currency={loading:!1,params:{from:"AUD",to:"BRL"},items:[]}}async init(){this.ready=!1,await this.userLoad(),await this.workspaceLoad(),await this.timeEntryLoad(),await this.currenciesLoad(),this.ready=!0}async request(t){return i.request({...t,url:["https://api.clockify.me/api/v1",t.url.replace(/^\/|\/$/g,"")].join("/"),headers:{"X-Api-Key":this.storage.token}})}async userLoad(){const{data:t}=await this.request({url:"/user"});this.user={id:t.id,email:t.email,name:t.name,profilePicture:t.profilePicture}}async workspaceLoad(){this.workspace.loading=!0;const{data:t}=await this.request({url:"/workspaces"});this.workspace.items=t,this.workspace.items.length==1&&(this.workspace.item=this.workspace.items[0]),this.workspace.loading=!1}async timeEntryLoad(){const{$dayjs:t}=r();this.timeEntry.loading&&clearTimeout(this.timeEntry.loading),this.timeEntry.loading=setTimeout(async()=>{if(!this.user||!this.workspace.item)return;const{data:s}=await this.request({url:`/workspaces/${this.workspace.item.id}/user/${this.user.id}/time-entries`,params:{start:t(this.date).startOf("month").format("YYYY-MM-DDTHH:mm:ss.000z"),end:t(this.date).endOf("month").format("YYYY-MM-DDTHH:mm:ss.000z")}});this.timeEntry.items=s.map(e=>(e.workedMinutes=(()=>{if(!e.timeInterval.end)return 0;let a=t(e.timeInterval.start).diff(e.timeInterval.end);return Math.max(a,a*-1)/1e3/60})(),e)),this.timeEntry.loading=!1},1e3)}async currenciesLoad(){this.currency.loading=!0;const{data:t}=await i.get("https://api.exchangerate.host/latest?base=USD");this.currency.items=Object.entries(t.rates).map(([s,e])=>({code:s,value:e})),this.currency.loading=!1}amountConvert(t){const s={code:"AUD",value:1.43},e={code:"BRL",value:5.1},a=2752.16,o=t*e.value/s.value;return console.clear(),console.log(JSON.stringify({value:t,expected:a,result:o,from:s,to:e}," ",2)),t}result(){const t=this.timeEntry.items.reduce((e,a)=>e+a.workedMinutes,0),s=this.storage.amountPerHour*(t/60);return{minutes:t,amount:s}}}export{l as default};
