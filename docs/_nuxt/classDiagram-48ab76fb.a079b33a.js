import{p as A,d as S,s as G}from"./styles-4ba6ed67.b55031e8.js";import{c as v,l as x,h as B,i as W,aq as $,z as M,at as I}from"./index.79be42fb.js";import{G as O,l as P}from"./layout.58df0795.js";import"./entry.43339234.js";import{l as X}from"./line.69a3c51f.js";import"./index.201ee895.js";import"./index.106d2f55.js";import"./index.77a2d6f4.js";import"./lodash.6d7087da.js";import"./index.9b41898b.js";import"./Bookapp.ab6c422f.js";import"./Calculator.266d9ea7.js";import"./index.784a8409.js";import"./info.054acc3a.js";import"./info.ecb60be2.js";import"./info.1e4bb3a9.js";import"./info.3c1f35c2.js";import"./three.module.6da1ccc8.js";import"./matter.6c55b71a.js";import"./scene-gltf.59dea089.js";import"./index.9c823635.js";import"./index.3806941a.js";import"./index.cf0e5a00.js";import"./index.7682f548.js";import"./index.72f7a1d6.js";import"./index.350dd821.js";import"./index.47f73a24.js";import"./index.be5365a8.js";import"./___vite-browser-external.e2f0af18.js";import"./index.ebeb5bf0.js";import"./index.83e22c22.js";import"./index.6ed044d3.js";import"./index.e92b5243.js";import"./index.12130721.js";import"./index.a92d658c.js";import"./info.72a08ec4.js";import"./info.bfb3dcff.js";import"./info.78333159.js";import"./info.72d8a16d.js";import"./info.71ed9620.js";import"./info.a88b74e6.js";import"./alert.8c9d52a1.js";import"./index.ed6e74f8.js";import"https://cdn.skypack.dev/dat.gui@0.7.9";import"./index.57df9be4.js";import"./array.9f3ba611.js";import"./path.53f90ab3.js";let H=0;const Y=function(a,r,t,s,p){const g=function(e){switch(e){case p.db.relationType.AGGREGATION:return"aggregation";case p.db.relationType.EXTENSION:return"extension";case p.db.relationType.COMPOSITION:return"composition";case p.db.relationType.DEPENDENCY:return"dependency";case p.db.relationType.LOLLIPOP:return"lollipop"}};r.points=r.points.filter(e=>!Number.isNaN(e.y));const o=r.points,c=X().x(function(e){return e.x}).y(function(e){return e.y}).curve($),n=a.append("path").attr("d",c(o)).attr("id","edge"+H).attr("class","relation");let i="";s.arrowMarkerAbsolute&&(i=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,i=i.replace(/\(/g,"\\("),i=i.replace(/\)/g,"\\)")),t.relation.lineType==1&&n.attr("class","relation dashed-line"),t.relation.lineType==10&&n.attr("class","relation dotted-line"),t.relation.type1!=="none"&&n.attr("marker-start","url("+i+"#"+g(t.relation.type1)+"Start)"),t.relation.type2!=="none"&&n.attr("marker-end","url("+i+"#"+g(t.relation.type2)+"End)");let u,h;const m=r.points.length;let b=M.calcLabelPosition(r.points);u=b.x,h=b.y;let y,f,w,k;if(m%2!==0&&m>1){let e=M.calcCardinalityPosition(t.relation.type1!=="none",r.points,r.points[0]),d=M.calcCardinalityPosition(t.relation.type2!=="none",r.points,r.points[m-1]);x.debug("cardinality_1_point "+JSON.stringify(e)),x.debug("cardinality_2_point "+JSON.stringify(d)),y=e.x,f=e.y,w=d.x,k=d.y}if(t.title!==void 0){const e=a.append("g").attr("class","classLabel"),d=e.append("text").attr("class","label").attr("x",u).attr("y",h).attr("fill","red").attr("text-anchor","middle").text(t.title);window.label=d;const l=d.node().getBBox();e.insert("rect",":first-child").attr("class","box").attr("x",l.x-s.padding/2).attr("y",l.y-s.padding/2).attr("width",l.width+s.padding).attr("height",l.height+s.padding)}x.info("Rendering relation "+JSON.stringify(t)),t.relationTitle1!==void 0&&t.relationTitle1!=="none"&&a.append("g").attr("class","cardinality").append("text").attr("class","type1").attr("x",y).attr("y",f).attr("fill","black").attr("font-size","6").text(t.relationTitle1),t.relationTitle2!==void 0&&t.relationTitle2!=="none"&&a.append("g").attr("class","cardinality").append("text").attr("class","type2").attr("x",w).attr("y",k).attr("fill","black").attr("font-size","6").text(t.relationTitle2),H++},J=function(a,r,t,s){x.debug("Rendering class ",r,t);const p=r.id,g={id:p,label:r.id,width:0,height:0},o=a.append("g").attr("id",s.db.lookUpDomId(p)).attr("class","classGroup");let c;r.link?c=o.append("svg:a").attr("xlink:href",r.link).attr("target",r.linkTarget).append("text").attr("y",t.textHeight+t.padding).attr("x",0):c=o.append("text").attr("y",t.textHeight+t.padding).attr("x",0);let n=!0;r.annotations.forEach(function(d){const l=c.append("tspan").text("«"+d+"»");n||l.attr("dy",t.textHeight),n=!1});let i=C(r);const u=c.append("tspan").text(i).attr("class","title");n||u.attr("dy",t.textHeight);const h=c.node().getBBox().height;let m,b,y;if(r.members.length>0){m=o.append("line").attr("x1",0).attr("y1",t.padding+h+t.dividerMargin/2).attr("y2",t.padding+h+t.dividerMargin/2);const d=o.append("text").attr("x",t.padding).attr("y",h+t.dividerMargin+t.textHeight).attr("fill","white").attr("class","classText");n=!0,r.members.forEach(function(l){_(d,l,n,t),n=!1}),b=d.node().getBBox()}if(r.methods.length>0){y=o.append("line").attr("x1",0).attr("y1",t.padding+h+t.dividerMargin+b.height).attr("y2",t.padding+h+t.dividerMargin+b.height);const d=o.append("text").attr("x",t.padding).attr("y",h+2*t.dividerMargin+b.height+t.textHeight).attr("fill","white").attr("class","classText");n=!0,r.methods.forEach(function(l){_(d,l,n,t),n=!1})}const f=o.node().getBBox();var w=" ";r.cssClasses.length>0&&(w=w+r.cssClasses.join(" "));const e=o.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",f.width+2*t.padding).attr("height",f.height+t.padding+.5*t.dividerMargin).attr("class",w).node().getBBox().width;return c.node().childNodes.forEach(function(d){d.setAttribute("x",(e-d.getBBox().width)/2)}),r.tooltip&&c.insert("title").text(r.tooltip),m&&m.attr("x2",e),y&&y.attr("x2",e),g.width=e,g.height=f.height+t.padding+.5*t.dividerMargin,g},C=function(a){let r=a.id;return a.type&&(r+="<"+I(a.type)+">"),r},Z=function(a,r,t,s){x.debug("Rendering note ",r,t);const p=r.id,g={id:p,text:r.text,width:0,height:0},o=a.append("g").attr("id",p).attr("class","classGroup");let c=o.append("text").attr("y",t.textHeight+t.padding).attr("x",0);const n=JSON.parse(`"${r.text}"`).split(`
`);n.forEach(function(m){x.debug(`Adding line: ${m}`),c.append("tspan").text(m).attr("class","title").attr("dy",t.textHeight)});const i=o.node().getBBox(),h=o.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",i.width+2*t.padding).attr("height",i.height+n.length*t.textHeight+t.padding+.5*t.dividerMargin).node().getBBox().width;return c.node().childNodes.forEach(function(m){m.setAttribute("x",(h-m.getBBox().width)/2)}),g.width=h,g.height=i.height+n.length*t.textHeight+t.padding+.5*t.dividerMargin,g},_=function(a,r,t,s){const{displayText:p,cssStyle:g}=r.getDisplayDetails(),o=a.append("tspan").attr("x",s.padding).text(p);g!==""&&o.attr("style",r.cssStyle),t||o.attr("dy",s.textHeight)},N={getClassTitleString:C,drawClass:J,drawEdge:Y,drawNote:Z};let T={};const E=20,L=function(a){const r=Object.entries(T).find(t=>t[1].label===a);if(r)return r[0]},R=function(a){a.append("defs").append("marker").attr("id","extensionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),a.append("defs").append("marker").attr("id","extensionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z"),a.append("defs").append("marker").attr("id","compositionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),a.append("defs").append("marker").attr("id","compositionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),a.append("defs").append("marker").attr("id","aggregationStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),a.append("defs").append("marker").attr("id","aggregationEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),a.append("defs").append("marker").attr("id","dependencyStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),a.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},z=function(a,r,t,s){const p=v().class;T={},x.info("Rendering diagram "+a);const g=v().securityLevel;let o;g==="sandbox"&&(o=B("#i"+r));const c=g==="sandbox"?B(o.nodes()[0].contentDocument.body):B("body"),n=c.select(`[id='${r}']`);R(n);const i=new O({multigraph:!0});i.setGraph({isMultiGraph:!0}),i.setDefaultEdgeLabel(function(){return{}});const u=s.db.getClasses(),h=Object.keys(u);for(const e of h){const d=u[e],l=N.drawClass(n,d,p,s);T[l.id]=l,i.setNode(l.id,l),x.info("Org height: "+l.height)}s.db.getRelations().forEach(function(e){x.info("tjoho"+L(e.id1)+L(e.id2)+JSON.stringify(e)),i.setEdge(L(e.id1),L(e.id2),{relation:e},e.title||"DEFAULT")}),s.db.getNotes().forEach(function(e){x.debug(`Adding note: ${JSON.stringify(e)}`);const d=N.drawNote(n,e,p,s);T[d.id]=d,i.setNode(d.id,d),e.class&&e.class in u&&i.setEdge(e.id,L(e.class),{relation:{id1:e.id,id2:e.class,relation:{type1:"none",type2:"none",lineType:10}}},"DEFAULT")}),P(i),i.nodes().forEach(function(e){e!==void 0&&i.node(e)!==void 0&&(x.debug("Node "+e+": "+JSON.stringify(i.node(e))),c.select("#"+(s.db.lookUpDomId(e)||e)).attr("transform","translate("+(i.node(e).x-i.node(e).width/2)+","+(i.node(e).y-i.node(e).height/2)+" )"))}),i.edges().forEach(function(e){e!==void 0&&i.edge(e)!==void 0&&(x.debug("Edge "+e.v+" -> "+e.w+": "+JSON.stringify(i.edge(e))),N.drawEdge(n,i.edge(e),i.edge(e).relation,p,s))});const y=n.node().getBBox(),f=y.width+E*2,w=y.height+E*2;W(n,w,f,p.useMaxWidth);const k=`${y.x-E} ${y.y-E} ${f} ${w}`;x.debug(`viewBox ${k}`),n.attr("viewBox",k)},F={draw:z},Xt={parser:A,db:S,renderer:F,styles:G,init:a=>{a.class||(a.class={}),a.class.arrowMarkerAbsolute=a.arrowMarkerAbsolute,S.clear()}};export{Xt as diagram};
