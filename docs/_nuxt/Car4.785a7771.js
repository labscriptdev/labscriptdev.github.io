import{E as C}from"./matter.9bf15a82.js";import"./three.module.2ad6d296.js";import"./entry.65fd9d93.js";class _ extends C{constructor(e){super(),this.name="Car",this.game=e.game,this.position.set(e.x||0,e.y||0,e.z||0),this.carWidth=2,this.carDepth=4,this.carMass=10,this.axisDistanceBetween=3.5,this.wheelRadius=.4,this.suspensionRestLength=.5,this.suspensionStiffness=50,this.suspensionDamping=.5,this.suspensionCompression=4.4,this.friction=50,this.rollInfluence=.01}preload(){return{mercedes:{type:"gltf",url:"/assets/threejs/models/vehicles/mercedes/scene.gltf"}}}onCreate(){this.carCreateVisual(),this.carCreatePhysics()}onUpdate(){this.carUpdate();const{camera:e}=this.game.getData();this.chassi.add(e),e.position.set(0,1,-this.carDepth-2),e.lookAt(this.chassi.position.clone())}carCreateVisual(){const{x:e,y:i,z:s}=this.position;this.chassi=this.meshCreate({type:"box",data:{x:e,y:i,z:s,width:this.carWidth,depth:this.carDepth,mass:5e3,height:.25},material:{lambert:{wireframe:!0}},physics:{mass:this.carMass},callback:a=>a}),this.wheels=[{x:-(this.carWidth/2),y:0,z:this.axisDistanceBetween/2},{x:this.carWidth/2,y:0,z:this.axisDistanceBetween/2},{x:-(this.carWidth/2),y:0,z:-(this.axisDistanceBetween/2)},{x:this.carWidth/2,y:0,z:-(this.axisDistanceBetween/2)}].map((a,h)=>this.meshCreate({type:"cylinder",data:{x:a.x,y:a.y,z:a.z,radiusBottom:this.wheelRadius,radiusTop:this.wheelRadius,radiusSegments:24,height:.35},material:{lambert:{color:h<=1?4352:2236928,transparent:!0,opacity:.5}},callback:n=>(n.geometry.center(),n)}))}carCreatePhysics(){this.position;const{physics:e}=this.game.getData(),{physicsWorld:i}=e,s=new Ammo.btVehicleTuning,a=new Ammo.btDefaultVehicleRaycaster(i),h=new Ammo.btRaycastVehicle(s,this.chassi.body.ammo,a);h.setCoordinateSystem(0,1,2),i.addAction(h),this.chassi.body.skipUpdate=!0,this.vehicle=h,this.wheels.forEach((n,c)=>{const r=c<=1,l=n.position.clone(),m=new Ammo.btVector3(l.x,l.y,l.z),g=new Ammo.btVector3(0,-1,0),t=new Ammo.btVector3(-1,0,0),o=h.addWheel(m,g,t,this.suspensionRestLength,this.wheelRadius,s,r);o.set_m_suspensionStiffness(this.suspensionStiffness),o.set_m_wheelsDampingRelaxation(this.suspensionDamping),o.set_m_wheelsDampingCompression(this.suspensionCompression),o.set_m_frictionSlip(this.friction),o.set_m_rollInfluence(this.rollInfluence)})}carUpdate(){const{input:e}=this.game.getData(),i=0,s=1,a=2,h=3;let n=0,c=0,r=.4,l=.8,m=50,g=50,t=0;e.w?n=m:e.s?n=-m:n=0,e.a?t<l&&(t+=r):e.d?t>-l&&(t-=r):(t>0&&(t-=r/2),t<0&&(t+=r/2),Math.abs(t)<=r&&(t=0)),e.space?c=g:c=0,this.vehicle.applyEngineForce(n,a),this.vehicle.applyEngineForce(n,h),this.vehicle.setSteeringValue(t,i),this.vehicle.setSteeringValue(t,s),this.vehicle.setBrake(c/2,i),this.vehicle.setBrake(c/2,s),this.vehicle.setBrake(c,a),this.vehicle.setBrake(c,h),(()=>{this.wheels.forEach((f,w)=>{let x=this.vehicle.getWheelTransformWS(w),y=x.getOrigin(),d=x.getRotation();f.position.set(y.x(),y.y(),y.z()),f.quaternion.set(d.x(),d.y(),d.z(),d.w()),f.rotateZ(Math.PI/2)});let o=this.vehicle.getChassisWorldTransform(),u=o.getOrigin(),p=o.getRotation();this.chassi.position.set(u.x(),u.y(),u.z()),this.chassi.quaternion.set(p.x(),p.y(),p.z(),p.w())})()}meshCreate(e={}){const{physics:i}=this.game.getData();let s=i.factory.add[e.type](e.data,e.material);return typeof e.callback=="function"&&(s=e.callback(s)),typeof e.physics=="object"&&i.add.existing(s,e.physics||{}),s}}export{_ as default};
