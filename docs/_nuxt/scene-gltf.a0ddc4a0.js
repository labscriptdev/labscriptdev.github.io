import{o as vt,p as Q,q as it,C as $,r as Bt,s as Ft,D as Ht,M as se,t as ae,u as Y,V as B,k as Z,b as C,I as Ut,e as ot,v as zt,w as Gt,x as re,y as Kt,z as rt,E as at,G as Ae,H as ct,J as pe,K as Me,N as Le,Q as lt,X as jt,B as Re,Y as Wt,a as ht,Z as dt,_ as ut,$ as Xt,a0 as mt,a1 as ge,P as ft,d as pt,O as Yt,a2 as qt,a3 as gt,a4 as Qt,a5 as Zt,a6 as yt,a7 as j,a8 as $t,a9 as Jt,aa as es,ab as ts,ac as ss,ad as ns,ae as is,af as os,ag as rs,ah as ze,ai as as,aj as cs,ak as Ge,al as ls,j as hs,am as ds,an as us,ao as bt,ap as ms,aq as fs,ar as ps,c as gs,as as ys,at as bs,au as Ts,av as ws,aw as xs,ax as As,ay as Es,az as ee,aA as te,aB as Ke,aC as Tt,aD as je,R as Ss,g as Ms,h as Ls,i as Rs,aE as _s,aF as Cs}from"./three.module.8fae685a.js";import{l as le,E as he,a as Ds,C as Os,b as Is,A as ks,c as ye,d as Ps,e as Ns,f as Vs,i as vs}from"./matter.fde04bf7.js";import{aM as Bs,aK as We,ay as Fs,aD as Hs,o as Us,e as zs,a as de,b9 as be,aP as Xe,g as Ye,d as Gs,t as Ks}from"./entry.2c083d03.js";class js extends vt{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(s){return new Qs(s)}),this.register(function(s){return new nn(s)}),this.register(function(s){return new on(s)}),this.register(function(s){return new $s(s)}),this.register(function(s){return new Js(s)}),this.register(function(s){return new en(s)}),this.register(function(s){return new tn(s)}),this.register(function(s){return new qs(s)}),this.register(function(s){return new sn(s)}),this.register(function(s){return new Zs(s)}),this.register(function(s){return new Xs(s)}),this.register(function(s){return new rn(s)}),this.register(function(s){return new an(s)})}load(t,s,e,n){const i=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=Q.extractUrlBase(t),this.manager.itemStart(t);const a=function(c){n?n(c):console.error(c),i.manager.itemError(t),i.manager.itemEnd(t)},r=new it(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,function(c){try{i.parse(c,o,function(h){s(h),i.manager.itemEnd(t)},a)}catch(h){a(h)}},e,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,s,e,n){let i;const o={},a={};if(typeof t=="string")i=JSON.parse(t);else if(t instanceof ArrayBuffer)if(Q.decodeText(new Uint8Array(t,0,4))===wt){try{o[L.KHR_BINARY_GLTF]=new cn(t)}catch(h){n&&n(h);return}i=JSON.parse(o[L.KHR_BINARY_GLTF].content)}else i=JSON.parse(Q.decodeText(new Uint8Array(t)));else i=t;if(i.asset===void 0||i.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const r=new xn(i,{path:s||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});r.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const h=this.pluginCallbacks[c](r);a[h.name]=h,o[h.name]=!0}if(i.extensionsUsed)for(let c=0;c<i.extensionsUsed.length;++c){const h=i.extensionsUsed[c],l=i.extensionsRequired||[];switch(h){case L.KHR_MATERIALS_UNLIT:o[h]=new Ys;break;case L.KHR_DRACO_MESH_COMPRESSION:o[h]=new ln(i,this.dracoLoader);break;case L.KHR_TEXTURE_TRANSFORM:o[h]=new hn;break;case L.KHR_MESH_QUANTIZATION:o[h]=new dn;break;default:l.indexOf(h)>=0&&a[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}r.setExtensions(o),r.setPlugins(a),r.parse(e,n)}parseAsync(t,s){const e=this;return new Promise(function(n,i){e.parse(t,s,n,i)})}}function Ws(){let m={};return{get:function(t){return m[t]},add:function(t,s){m[t]=s},remove:function(t){delete m[t]},removeAll:function(){m={}}}}const L={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Xs{constructor(t){this.parser=t,this.name=L.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,s=this.parser.json.nodes||[];for(let e=0,n=s.length;e<n;e++){const i=s[e];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const s=this.parser,e="light:"+t;let n=s.cache.get(e);if(n)return n;const i=s.json,r=((i.extensions&&i.extensions[this.name]||{}).lights||[])[t];let c;const h=new $(16777215);r.color!==void 0&&h.fromArray(r.color);const l=r.range!==void 0?r.range:0;switch(r.type){case"directional":c=new Ht(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Ft(h),c.distance=l;break;case"spot":c=new Bt(h),c.distance=l,r.spot=r.spot||{},r.spot.innerConeAngle=r.spot.innerConeAngle!==void 0?r.spot.innerConeAngle:0,r.spot.outerConeAngle=r.spot.outerConeAngle!==void 0?r.spot.outerConeAngle:Math.PI/4,c.angle=r.spot.outerConeAngle,c.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return c.position.set(0,0,0),c.decay=2,X(c,r),r.intensity!==void 0&&(c.intensity=r.intensity),c.name=s.createUniqueName(r.name||"light_"+t),n=Promise.resolve(c),s.cache.add(e,n),n}getDependency(t,s){if(t==="light")return this._loadLight(s)}createNodeAttachment(t){const s=this,e=this.parser,i=e.json.nodes[t],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(r){return e._getNodeRef(s.cache,a,r)})}}class Ys{constructor(){this.name=L.KHR_MATERIALS_UNLIT}getMaterialType(){return se}extendParams(t,s,e){const n=[];t.color=new $(1,1,1),t.opacity=1;const i=s.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const o=i.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}i.baseColorTexture!==void 0&&n.push(e.assignTexture(t,"map",i.baseColorTexture,ae))}return Promise.all(n)}}class qs{constructor(t){this.parser=t,this.name=L.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,s){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return i!==void 0&&(s.emissiveIntensity=i),Promise.resolve()}}class Qs{constructor(t){this.parser=t,this.name=L.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:Y}extendMaterialParams(t,s){const e=this.parser,n=e.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(s.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&i.push(e.assignTexture(s,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(s.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&i.push(e.assignTexture(s,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(i.push(e.assignTexture(s,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;s.clearcoatNormalScale=new B(a,a)}return Promise.all(i)}}class Zs{constructor(t){this.parser=t,this.name=L.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:Y}extendMaterialParams(t,s){const e=this.parser,n=e.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return o.iridescenceFactor!==void 0&&(s.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&i.push(e.assignTexture(s,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(s.iridescenceIOR=o.iridescenceIor),s.iridescenceThicknessRange===void 0&&(s.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(s.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(s.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&i.push(e.assignTexture(s,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}}class $s{constructor(t){this.parser=t,this.name=L.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:Y}extendMaterialParams(t,s){const e=this.parser,n=e.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[];s.sheenColor=new $(0,0,0),s.sheenRoughness=0,s.sheen=1;const o=n.extensions[this.name];return o.sheenColorFactor!==void 0&&s.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(s.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&i.push(e.assignTexture(s,"sheenColorMap",o.sheenColorTexture,ae)),o.sheenRoughnessTexture!==void 0&&i.push(e.assignTexture(s,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}class Js{constructor(t){this.parser=t,this.name=L.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:Y}extendMaterialParams(t,s){const e=this.parser,n=e.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(s.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&i.push(e.assignTexture(s,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class en{constructor(t){this.parser=t,this.name=L.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:Y}extendMaterialParams(t,s){const e=this.parser,n=e.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];s.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&i.push(e.assignTexture(s,"thicknessMap",o.thicknessTexture)),s.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return s.attenuationColor=new $(a[0],a[1],a[2]),Promise.all(i)}}class tn{constructor(t){this.parser=t,this.name=L.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:Y}extendMaterialParams(t,s){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return s.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class sn{constructor(t){this.parser=t,this.name=L.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:Y}extendMaterialParams(t,s){const e=this.parser,n=e.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];s.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&i.push(e.assignTexture(s,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return s.specularColor=new $(a[0],a[1],a[2]),o.specularColorTexture!==void 0&&i.push(e.assignTexture(s,"specularColorMap",o.specularColorTexture,ae)),Promise.all(i)}}class nn{constructor(t){this.parser=t,this.name=L.KHR_TEXTURE_BASISU}loadTexture(t){const s=this.parser,e=s.json,n=e.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],o=s.options.ktx2Loader;if(!o){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return s.loadTextureImage(t,i.source,o)}}class on{constructor(t){this.parser=t,this.name=L.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const s=this.name,e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[s])return null;const o=i.extensions[s],a=n.images[o.source];let r=e.textureLoader;if(a.uri){const c=e.options.manager.getHandler(a.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return e.loadTextureImage(t,o.source,r);if(n.extensionsRequired&&n.extensionsRequired.indexOf(s)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return e.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const s=new Image;s.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",s.onload=s.onerror=function(){t(s.height===1)}})),this.isSupported}}class rn{constructor(t){this.name=L.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const s=this.parser.json,e=s.bufferViews[t];if(e.extensions&&e.extensions[this.name]){const n=e.extensions[this.name],i=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(a){const r=n.byteOffset||0,c=n.byteLength||0,h=n.count,l=n.byteStride,d=new Uint8Array(a,r,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,l,d,n.mode,n.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(h*l);return o.decodeGltfBuffer(new Uint8Array(f),h,l,d,n.mode,n.filter),f})})}else return null}}class an{constructor(t){this.name=L.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const s=this.parser.json,e=s.nodes[t];if(!e.extensions||!e.extensions[this.name]||e.mesh===void 0)return null;const n=s.meshes[e.mesh];for(const c of n.primitives)if(c.mode!==F.TRIANGLES&&c.mode!==F.TRIANGLE_STRIP&&c.mode!==F.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=e.extensions[this.name].attributes,a=[],r={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(h=>(r[c]=h,r[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(t)),Promise.all(a).then(c=>{const h=c.pop(),l=h.isGroup?h.children:[h],d=c[0].count,f=[];for(const g of l){const b=new Z,y=new C,p=new j,x=new C(1,1,1),S=new Ut(g.geometry,g.material,d);for(let A=0;A<d;A++)r.TRANSLATION&&y.fromBufferAttribute(r.TRANSLATION,A),r.ROTATION&&p.fromBufferAttribute(r.ROTATION,A),r.SCALE&&x.fromBufferAttribute(r.SCALE,A),S.setMatrixAt(A,b.compose(y,p,x));for(const A in r)A!=="TRANSLATION"&&A!=="ROTATION"&&A!=="SCALE"&&g.geometry.setAttribute(A,r[A]);ot.prototype.copy.call(S,g),S.frustumCulled=!1,this.parser.assignFinalMaterial(S),f.push(S)}return h.isGroup?(h.clear(),h.add(...f),h):f[0]}))}}const wt="glTF",ie=12,qe={JSON:1313821514,BIN:5130562};class cn{constructor(t){this.name=L.KHR_BINARY_GLTF,this.content=null,this.body=null;const s=new DataView(t,0,ie);if(this.header={magic:Q.decodeText(new Uint8Array(t.slice(0,4))),version:s.getUint32(4,!0),length:s.getUint32(8,!0)},this.header.magic!==wt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const e=this.header.length-ie,n=new DataView(t,ie);let i=0;for(;i<e;){const o=n.getUint32(i,!0);i+=4;const a=n.getUint32(i,!0);if(i+=4,a===qe.JSON){const r=new Uint8Array(t,ie+i,o);this.content=Q.decodeText(r)}else if(a===qe.BIN){const r=ie+i;this.body=t.slice(r,r+o)}i+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ln{constructor(t,s){if(!s)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=L.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=s,this.dracoLoader.preload()}decodePrimitive(t,s){const e=this.json,n=this.dracoLoader,i=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,a={},r={},c={};for(const h in o){const l=Ee[h]||h.toLowerCase();a[l]=o[h]}for(const h in t.attributes){const l=Ee[h]||h.toLowerCase();if(o[h]!==void 0){const d=e.accessors[t.attributes[h]],f=ne[d.componentType];c[l]=f.name,r[l]=d.normalized===!0}}return s.getDependency("bufferView",i).then(function(h){return new Promise(function(l){n.decodeDracoFile(h,function(d){for(const f in d.attributes){const g=d.attributes[f],b=r[f];b!==void 0&&(g.normalized=b)}l(d)},a,c)})})}}class hn{constructor(){this.name=L.KHR_TEXTURE_TRANSFORM}extendTexture(t,s){return s.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),s.offset===void 0&&s.rotation===void 0&&s.scale===void 0||(t=t.clone(),s.offset!==void 0&&t.offset.fromArray(s.offset),s.rotation!==void 0&&(t.rotation=s.rotation),s.scale!==void 0&&t.repeat.fromArray(s.scale),t.needsUpdate=!0),t}}class dn{constructor(){this.name=L.KHR_MESH_QUANTIZATION}}class xt extends us{constructor(t,s,e,n){super(t,s,e,n)}copySampleValue_(t){const s=this.resultBuffer,e=this.sampleValues,n=this.valueSize,i=t*n*3+n;for(let o=0;o!==n;o++)s[o]=e[i+o];return s}interpolate_(t,s,e,n){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,r=a*2,c=a*3,h=n-s,l=(e-s)/h,d=l*l,f=d*l,g=t*c,b=g-c,y=-2*f+3*d,p=f-d,x=1-y,S=p-d+l;for(let A=0;A!==a;A++){const T=o[b+A+a],D=o[b+A+r]*h,k=o[g+A+a],P=o[g+A]*h;i[A]=x*T+S*D+y*k+p*P}return i}}const un=new j;class mn extends xt{interpolate_(t,s,e,n){const i=super.interpolate_(t,s,e,n);return un.fromArray(i).normalize().toArray(i),i}}const F={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ne={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qe={9728:$t,9729:rt,9984:Jt,9985:es,9986:ts,9987:at},Ze={33071:ss,33648:ns,10497:Ae},Te={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ee={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},W={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},fn={CUBICSPLINE:void 0,LINEAR:gt,STEP:is},we={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function pn(m){return m.DefaultMaterial===void 0&&(m.DefaultMaterial=new Le({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:os})),m.DefaultMaterial}function oe(m,t,s){for(const e in s.extensions)m[e]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[e]=s.extensions[e])}function X(m,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(m.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function gn(m,t,s){let e=!1,n=!1,i=!1;for(let c=0,h=t.length;c<h;c++){const l=t[c];if(l.POSITION!==void 0&&(e=!0),l.NORMAL!==void 0&&(n=!0),l.COLOR_0!==void 0&&(i=!0),e&&n&&i)break}if(!e&&!n&&!i)return Promise.resolve(m);const o=[],a=[],r=[];for(let c=0,h=t.length;c<h;c++){const l=t[c];if(e){const d=l.POSITION!==void 0?s.getDependency("accessor",l.POSITION):m.attributes.position;o.push(d)}if(n){const d=l.NORMAL!==void 0?s.getDependency("accessor",l.NORMAL):m.attributes.normal;a.push(d)}if(i){const d=l.COLOR_0!==void 0?s.getDependency("accessor",l.COLOR_0):m.attributes.color;r.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(r)]).then(function(c){const h=c[0],l=c[1],d=c[2];return e&&(m.morphAttributes.position=h),n&&(m.morphAttributes.normal=l),i&&(m.morphAttributes.color=d),m.morphTargetsRelative=!0,m})}function yn(m,t){if(m.updateMorphTargets(),t.weights!==void 0)for(let s=0,e=t.weights.length;s<e;s++)m.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(m.morphTargetInfluences.length===s.length){m.morphTargetDictionary={};for(let e=0,n=s.length;e<n;e++)m.morphTargetDictionary[s[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function bn(m){const t=m.extensions&&m.extensions[L.KHR_DRACO_MESH_COMPRESSION];let s;return t?s="draco:"+t.bufferView+":"+t.indices+":"+$e(t.attributes):s=m.indices+":"+$e(m.attributes)+":"+m.mode,s}function $e(m){let t="";const s=Object.keys(m).sort();for(let e=0,n=s.length;e<n;e++)t+=s[e]+":"+m[s[e]]+";";return t}function Se(m){switch(m){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Tn(m){return m.search(/\.jpe?g($|\?)/i)>0||m.search(/^data\:image\/jpeg/)===0?"image/jpeg":m.search(/\.webp($|\?)/i)>0||m.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const wn=new Z;class xn{constructor(t={},s={}){this.json=t,this.extensions={},this.plugins={},this.options=s,this.cache=new Ws,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let e=!1,n=!1,i=-1;typeof navigator<"u"&&(e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,i=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||e||n&&i<98?this.textureLoader=new zt(this.options.manager):this.textureLoader=new Gt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new it(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,s){const e=this,n=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([e.getDependencies("scene"),e.getDependencies("animation"),e.getDependencies("camera")])}).then(function(o){const a={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:e,userData:{}};oe(i,a,n),X(a,n),Promise.all(e._invokeAll(function(r){return r.afterRoot&&r.afterRoot(a)})).then(function(){t(a)})}).catch(s)}_markDefs(){const t=this.json.nodes||[],s=this.json.skins||[],e=this.json.meshes||[];for(let n=0,i=s.length;n<i;n++){const o=s[n].joints;for(let a=0,r=o.length;a<r;a++)t[o[a]].isBone=!0}for(let n=0,i=t.length;n<i;n++){const o=t[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(e[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(t,s){s!==void 0&&(t.refs[s]===void 0&&(t.refs[s]=t.uses[s]=0),t.refs[s]++)}_getNodeRef(t,s,e){if(t.refs[s]<=1)return e;const n=e.clone(),i=(o,a)=>{const r=this.associations.get(o);r!=null&&this.associations.set(a,r);for(const[c,h]of o.children.entries())i(h,a.children[c])};return i(e,n),n.name+="_instance_"+t.uses[s]++,n}_invokeOne(t){const s=Object.values(this.plugins);s.push(this);for(let e=0;e<s.length;e++){const n=t(s[e]);if(n)return n}return null}_invokeAll(t){const s=Object.values(this.plugins);s.unshift(this);const e=[];for(let n=0;n<s.length;n++){const i=t(s[n]);i&&e.push(i)}return e}getDependency(t,s){const e=t+":"+s;let n=this.cache.get(e);if(!n){switch(t){case"scene":n=this.loadScene(s);break;case"node":n=this._invokeOne(function(i){return i.loadNode&&i.loadNode(s)});break;case"mesh":n=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(s)});break;case"accessor":n=this.loadAccessor(s);break;case"bufferView":n=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(s)});break;case"buffer":n=this.loadBuffer(s);break;case"material":n=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(s)});break;case"texture":n=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(s)});break;case"skin":n=this.loadSkin(s);break;case"animation":n=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(s)});break;case"camera":n=this.loadCamera(s);break;default:if(n=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(t,s)}),!n)throw new Error("Unknown type: "+t);break}this.cache.add(e,n)}return n}getDependencies(t){let s=this.cache.get(t);if(!s){const e=this,n=this.json[t+(t==="mesh"?"es":"s")]||[];s=Promise.all(n.map(function(i,o){return e.getDependency(t,o)})),this.cache.add(t,s)}return s}loadBuffer(t){const s=this.json.buffers[t],e=this.fileLoader;if(s.type&&s.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+s.type+" buffer type is not supported.");if(s.uri===void 0&&t===0)return Promise.resolve(this.extensions[L.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(i,o){e.load(Q.resolveURL(s.uri,n.path),i,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+s.uri+'".'))})})}loadBufferView(t){const s=this.json.bufferViews[t];return this.getDependency("buffer",s.buffer).then(function(e){const n=s.byteLength||0,i=s.byteOffset||0;return e.slice(i,i+n)})}loadAccessor(t){const s=this,e=this.json,n=this.json.accessors[t];if(n.bufferView===void 0&&n.sparse===void 0){const o=Te[n.type],a=ne[n.componentType],r=n.normalized===!0,c=new a(n.count*o);return Promise.resolve(new re(c,o,r))}const i=[];return n.bufferView!==void 0?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),n.sparse!==void 0&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(o){const a=o[0],r=Te[n.type],c=ne[n.componentType],h=c.BYTES_PER_ELEMENT,l=h*r,d=n.byteOffset||0,f=n.bufferView!==void 0?e.bufferViews[n.bufferView].byteStride:void 0,g=n.normalized===!0;let b,y;if(f&&f!==l){const p=Math.floor(d/f),x="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+p+":"+n.count;let S=s.cache.get(x);S||(b=new c(a,p*f,n.count*f/h),S=new Kt(b,f/h),s.cache.add(x,S)),y=new rs(S,r,d%f/h,g)}else a===null?b=new c(n.count*r):b=new c(a,d,n.count*r),y=new re(b,r,g);if(n.sparse!==void 0){const p=Te.SCALAR,x=ne[n.sparse.indices.componentType],S=n.sparse.indices.byteOffset||0,A=n.sparse.values.byteOffset||0,T=new x(o[1],S,n.sparse.count*p),D=new c(o[2],A,n.sparse.count*r);a!==null&&(y=new re(y.array.slice(),y.itemSize,y.normalized));for(let k=0,P=T.length;k<P;k++){const E=T[k];if(y.setX(E,D[k*r]),r>=2&&y.setY(E,D[k*r+1]),r>=3&&y.setZ(E,D[k*r+2]),r>=4&&y.setW(E,D[k*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(t){const s=this.json,e=this.options,i=s.textures[t].source,o=s.images[i];let a=this.textureLoader;if(o.uri){const r=e.manager.getHandler(o.uri);r!==null&&(a=r)}return this.loadTextureImage(t,i,a)}loadTextureImage(t,s,e){const n=this,i=this.json,o=i.textures[t],a=i.images[s],r=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[r])return this.textureCache[r];const c=this.loadImageSource(s,e).then(function(h){h.flipY=!1,h.name=o.name||a.name||"";const d=(i.samplers||{})[o.sampler]||{};return h.magFilter=Qe[d.magFilter]||rt,h.minFilter=Qe[d.minFilter]||at,h.wrapS=Ze[d.wrapS]||Ae,h.wrapT=Ze[d.wrapT]||Ae,n.associations.set(h,{textures:t}),h}).catch(function(){return null});return this.textureCache[r]=c,c}loadImageSource(t,s){const e=this,n=this.json,i=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(l=>l.clone());const o=n.images[t],a=self.URL||self.webkitURL;let r=o.uri||"",c=!1;if(o.bufferView!==void 0)r=e.getDependency("bufferView",o.bufferView).then(function(l){c=!0;const d=new Blob([l],{type:o.mimeType});return r=a.createObjectURL(d),r});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const h=Promise.resolve(r).then(function(l){return new Promise(function(d,f){let g=d;s.isImageBitmapLoader===!0&&(g=function(b){const y=new ze(b);y.needsUpdate=!0,d(y)}),s.load(Q.resolveURL(l,i.path),g,void 0,f)})}).then(function(l){return c===!0&&a.revokeObjectURL(r),l.userData.mimeType=o.mimeType||Tn(o.uri),l}).catch(function(l){throw console.error("THREE.GLTFLoader: Couldn't load texture",r),l});return this.sourceCache[t]=h,h}assignTexture(t,s,e,n){const i=this;return this.getDependency("texture",e.index).then(function(o){if(!o)return null;if(e.texCoord!==void 0&&e.texCoord!=0&&!(s==="aoMap"&&e.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+e.texCoord+" for texture "+s+" not yet supported."),i.extensions[L.KHR_TEXTURE_TRANSFORM]){const a=e.extensions!==void 0?e.extensions[L.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const r=i.associations.get(o);o=i.extensions[L.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),i.associations.set(o,r)}}return n!==void 0&&(o.encoding=n),t[s]=o,o})}assignFinalMaterial(t){const s=t.geometry;let e=t.material;const n=s.attributes.tangent===void 0,i=s.attributes.color!==void 0,o=s.attributes.normal===void 0;if(t.isPoints){const a="PointsMaterial:"+e.uuid;let r=this.cache.get(a);r||(r=new ct,pe.prototype.copy.call(r,e),r.color.copy(e.color),r.map=e.map,r.sizeAttenuation=!1,this.cache.add(a,r)),e=r}else if(t.isLine){const a="LineBasicMaterial:"+e.uuid;let r=this.cache.get(a);r||(r=new Me,pe.prototype.copy.call(r,e),r.color.copy(e.color),this.cache.add(a,r)),e=r}if(n||i||o){let a="ClonedMaterial:"+e.uuid+":";n&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let r=this.cache.get(a);r||(r=e.clone(),i&&(r.vertexColors=!0),o&&(r.flatShading=!0),n&&(r.normalScale&&(r.normalScale.y*=-1),r.clearcoatNormalScale&&(r.clearcoatNormalScale.y*=-1)),this.cache.add(a,r),this.associations.set(r,this.associations.get(e))),e=r}e.aoMap&&s.attributes.uv2===void 0&&s.attributes.uv!==void 0&&s.setAttribute("uv2",s.attributes.uv),t.material=e}getMaterialType(){return Le}loadMaterial(t){const s=this,e=this.json,n=this.extensions,i=e.materials[t];let o;const a={},r=i.extensions||{},c=[];if(r[L.KHR_MATERIALS_UNLIT]){const l=n[L.KHR_MATERIALS_UNLIT];o=l.getMaterialType(),c.push(l.extendParams(a,i,s))}else{const l=i.pbrMetallicRoughness||{};if(a.color=new $(1,1,1),a.opacity=1,Array.isArray(l.baseColorFactor)){const d=l.baseColorFactor;a.color.fromArray(d),a.opacity=d[3]}l.baseColorTexture!==void 0&&c.push(s.assignTexture(a,"map",l.baseColorTexture,ae)),a.metalness=l.metallicFactor!==void 0?l.metallicFactor:1,a.roughness=l.roughnessFactor!==void 0?l.roughnessFactor:1,l.metallicRoughnessTexture!==void 0&&(c.push(s.assignTexture(a,"metalnessMap",l.metallicRoughnessTexture)),c.push(s.assignTexture(a,"roughnessMap",l.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(t)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(t,a)})))}i.doubleSided===!0&&(a.side=lt);const h=i.alphaMode||we.OPAQUE;if(h===we.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===we.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&o!==se&&(c.push(s.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new B(1,1),i.normalTexture.scale!==void 0)){const l=i.normalTexture.scale;a.normalScale.set(l,l)}return i.occlusionTexture!==void 0&&o!==se&&(c.push(s.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&o!==se&&(a.emissive=new $().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&o!==se&&c.push(s.assignTexture(a,"emissiveMap",i.emissiveTexture,ae)),Promise.all(c).then(function(){const l=new o(a);return i.name&&(l.name=i.name),X(l,i),s.associations.set(l,{materials:t}),i.extensions&&oe(n,l,i),l})}createUniqueName(t){const s=jt.sanitizeNodeName(t||"");let e=s;for(let n=1;this.nodeNamesUsed[e];++n)e=s+"_"+n;return this.nodeNamesUsed[e]=!0,e}loadGeometries(t){const s=this,e=this.extensions,n=this.primitiveCache;function i(a){return e[L.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,s).then(function(r){return Je(r,a,s)})}const o=[];for(let a=0,r=t.length;a<r;a++){const c=t[a],h=bn(c),l=n[h];if(l)o.push(l.promise);else{let d;c.extensions&&c.extensions[L.KHR_DRACO_MESH_COMPRESSION]?d=i(c):d=Je(new Re,c,s),n[h]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(t){const s=this,e=this.json,n=this.extensions,i=e.meshes[t],o=i.primitives,a=[];for(let r=0,c=o.length;r<c;r++){const h=o[r].material===void 0?pn(this.cache):this.getDependency("material",o[r].material);a.push(h)}return a.push(s.loadGeometries(o)),Promise.all(a).then(function(r){const c=r.slice(0,r.length-1),h=r[r.length-1],l=[];for(let f=0,g=h.length;f<g;f++){const b=h[f],y=o[f];let p;const x=c[f];if(y.mode===F.TRIANGLES||y.mode===F.TRIANGLE_STRIP||y.mode===F.TRIANGLE_FAN||y.mode===void 0)p=i.isSkinnedMesh===!0?new Wt(b,x):new ht(b,x),p.isSkinnedMesh===!0&&!p.geometry.attributes.skinWeight.normalized&&p.normalizeSkinWeights(),y.mode===F.TRIANGLE_STRIP?p.geometry=et(p.geometry,as):y.mode===F.TRIANGLE_FAN&&(p.geometry=et(p.geometry,yt));else if(y.mode===F.LINES)p=new dt(b,x);else if(y.mode===F.LINE_STRIP)p=new ut(b,x);else if(y.mode===F.LINE_LOOP)p=new Xt(b,x);else if(y.mode===F.POINTS)p=new mt(b,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(p.geometry.morphAttributes).length>0&&yn(p,i),p.name=s.createUniqueName(i.name||"mesh_"+t),X(p,i),y.extensions&&oe(n,p,y),s.assignFinalMaterial(p),l.push(p)}for(let f=0,g=l.length;f<g;f++)s.associations.set(l[f],{meshes:t,primitives:f});if(l.length===1)return l[0];const d=new ge;s.associations.set(d,{meshes:t});for(let f=0,g=l.length;f<g;f++)d.add(l[f]);return d})}loadCamera(t){let s;const e=this.json.cameras[t],n=e[e.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return e.type==="perspective"?s=new ft(pt.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):e.type==="orthographic"&&(s=new Yt(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),e.name&&(s.name=this.createUniqueName(e.name)),X(s,e),Promise.resolve(s)}loadSkin(t){const s=this.json.skins[t],e=[];for(let n=0,i=s.joints.length;n<i;n++)e.push(this.getDependency("node",s.joints[n]));return s.inverseBindMatrices!==void 0?e.push(this.getDependency("accessor",s.inverseBindMatrices)):e.push(null),Promise.all(e).then(function(n){const i=n.pop(),o=n,a=[],r=[];for(let c=0,h=o.length;c<h;c++){const l=o[c];if(l){a.push(l);const d=new Z;i!==null&&d.fromArray(i.array,c*16),r.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[c])}return new qt(a,r)})}loadAnimation(t){const e=this.json.animations[t],n=[],i=[],o=[],a=[],r=[];for(let c=0,h=e.channels.length;c<h;c++){const l=e.channels[c],d=e.samplers[l.sampler],f=l.target,g=f.node,b=e.parameters!==void 0?e.parameters[d.input]:d.input,y=e.parameters!==void 0?e.parameters[d.output]:d.output;n.push(this.getDependency("node",g)),i.push(this.getDependency("accessor",b)),o.push(this.getDependency("accessor",y)),a.push(d),r.push(f)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(o),Promise.all(a),Promise.all(r)]).then(function(c){const h=c[0],l=c[1],d=c[2],f=c[3],g=c[4],b=[];for(let p=0,x=h.length;p<x;p++){const S=h[p],A=l[p],T=d[p],D=f[p],k=g[p];if(S===void 0)continue;S.updateMatrix();let P;switch(W[k.path]){case W.weights:P=ls;break;case W.rotation:P=Ge;break;case W.position:case W.scale:default:P=cs;break}const E=S.name?S.name:S.uuid,R=D.interpolation!==void 0?fn[D.interpolation]:gt,I=[];W[k.path]===W.weights?S.traverse(function(M){M.morphTargetInfluences&&I.push(M.name?M.name:M.uuid)}):I.push(E);let _=T.array;if(T.normalized){const M=Se(_.constructor),O=new Float32Array(_.length);for(let v=0,z=_.length;v<z;v++)O[v]=_[v]*M;_=O}for(let M=0,O=I.length;M<O;M++){const v=new P(I[M]+"."+W[k.path],A.array,_,R);D.interpolation==="CUBICSPLINE"&&(v.createInterpolant=function(U){const q=this instanceof Ge?mn:xt;return new q(this.times,this.values,this.getValueSize()/3,U)},v.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),b.push(v)}}const y=e.name?e.name:"animation_"+t;return new Qt(y,void 0,b)})}createNodeMesh(t){const s=this.json,e=this,n=s.nodes[t];return n.mesh===void 0?null:e.getDependency("mesh",n.mesh).then(function(i){const o=e._getNodeRef(e.meshCache,n.mesh,i);return n.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let r=0,c=n.weights.length;r<c;r++)a.morphTargetInfluences[r]=n.weights[r]}),o})}loadNode(t){const s=this.json,e=this.extensions,n=this,i=s.nodes[t],o=i.name?n.createUniqueName(i.name):"";return function(){const a=[],r=n._invokeOne(function(d){return d.createNodeMesh&&d.createNodeMesh(t)});r&&a.push(r),i.camera!==void 0&&a.push(n.getDependency("camera",i.camera).then(function(d){return n._getNodeRef(n.cameraCache,i.camera,d)})),n._invokeAll(function(d){return d.createNodeAttachment&&d.createNodeAttachment(t)}).forEach(function(d){a.push(d)});const c=[],h=i.children||[];for(let d=0,f=h.length;d<f;d++)c.push(n.getDependency("node",h[d]));const l=i.skin===void 0?Promise.resolve(null):n.getDependency("skin",i.skin);return Promise.all([Promise.all(a),Promise.all(c),l])}().then(function(a){const r=a[0],c=a[1],h=a[2];let l;if(i.isBone===!0?l=new Zt:r.length>1?l=new ge:r.length===1?l=r[0]:l=new ot,l!==r[0])for(let d=0,f=r.length;d<f;d++)l.add(r[d]);if(i.name&&(l.userData.name=i.name,l.name=o),X(l,i),i.extensions&&oe(e,l,i),i.matrix!==void 0){const d=new Z;d.fromArray(i.matrix),l.applyMatrix4(d)}else i.translation!==void 0&&l.position.fromArray(i.translation),i.rotation!==void 0&&l.quaternion.fromArray(i.rotation),i.scale!==void 0&&l.scale.fromArray(i.scale);n.associations.has(l)||n.associations.set(l,{}),n.associations.get(l).nodes=t,h!==null&&l.traverse(function(d){d.isSkinnedMesh&&d.bind(h,wn)});for(let d=0,f=c.length;d<f;d++)l.add(c[d]);return l})}loadScene(t){const s=this.extensions,e=this.json.scenes[t],n=this,i=new ge;e.name&&(i.name=n.createUniqueName(e.name)),X(i,e),e.extensions&&oe(s,i,e);const o=e.nodes||[],a=[];for(let r=0,c=o.length;r<c;r++)a.push(n.getDependency("node",o[r]));return Promise.all(a).then(function(r){for(let h=0,l=r.length;h<l;h++)i.add(r[h]);const c=h=>{const l=new Map;for(const[d,f]of n.associations)(d instanceof pe||d instanceof ze)&&l.set(d,f);return h.traverse(d=>{const f=n.associations.get(d);f!=null&&l.set(d,f)}),l};return n.associations=c(i),i})}}function An(m,t,s){const e=t.attributes,n=new hs;if(e.POSITION!==void 0){const a=s.json.accessors[e.POSITION],r=a.min,c=a.max;if(r!==void 0&&c!==void 0){if(n.set(new C(r[0],r[1],r[2]),new C(c[0],c[1],c[2])),a.normalized){const h=Se(ne[a.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=t.targets;if(i!==void 0){const a=new C,r=new C;for(let c=0,h=i.length;c<h;c++){const l=i[c];if(l.POSITION!==void 0){const d=s.json.accessors[l.POSITION],f=d.min,g=d.max;if(f!==void 0&&g!==void 0){if(r.setX(Math.max(Math.abs(f[0]),Math.abs(g[0]))),r.setY(Math.max(Math.abs(f[1]),Math.abs(g[1]))),r.setZ(Math.max(Math.abs(f[2]),Math.abs(g[2]))),d.normalized){const b=Se(ne[d.componentType]);r.multiplyScalar(b)}a.max(r)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}m.boundingBox=n;const o=new ds;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,m.boundingSphere=o}function Je(m,t,s){const e=t.attributes,n=[];function i(o,a){return s.getDependency("accessor",o).then(function(r){m.setAttribute(a,r)})}for(const o in e){const a=Ee[o]||o.toLowerCase();a in m.attributes||n.push(i(e[o],a))}if(t.indices!==void 0&&!m.index){const o=s.getDependency("accessor",t.indices).then(function(a){m.setIndex(a)});n.push(o)}return X(m,t),An(m,t,s),Promise.all(n).then(function(){return t.targets!==void 0?gn(m,t.targets,s):m})}function et(m,t){let s=m.getIndex();if(s===null){const o=[],a=m.getAttribute("position");if(a!==void 0){for(let r=0;r<a.count;r++)o.push(r);m.setIndex(o),s=m.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),m}const e=s.count-2,n=[];if(t===yt)for(let o=1;o<=e;o++)n.push(s.getX(0)),n.push(s.getX(o)),n.push(s.getX(o+1));else for(let o=0;o<e;o++)o%2===0?(n.push(s.getX(o)),n.push(s.getX(o+1)),n.push(s.getX(o+2))):(n.push(s.getX(o+2)),n.push(s.getX(o+1)),n.push(s.getX(o)));n.length/3!==e&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=m.clone();return i.setIndex(n),i}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */class En extends ht{constructor(t,s){super(t,s),this.isExtendedMesh=!0,this.isGroup=!1,this.vector3=new C,this.hasBody=!1,this.fragmentDepth=0,this.breakable=!1,this.fractureImpulse=1,this.name=`object-${this.id}`}get world(){return{theta:this.worldTheta,phi:this.worldPhi}}get worldTheta(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}get worldPhi(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}}class At{constructor(){this._defaultMaterial=new bt({color:13421772})}get(){return this._defaultMaterial}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */class Sn{constructor(t){this.scene=t,this.isHeadless=t==="headless",this.defaultMaterial=new At}get make(){return{plane:(t={},s={})=>this.makePlane(t,s),box:(t={},s={})=>this.makeBox(t,s),sphere:(t={},s={})=>this.makeSphere(t,s),cylinder:(t={},s={})=>this.makeCylinder(t,s),cone:(t={},s={})=>this.makeCone(t,s),torus:(t={},s={})=>this.makeTorus(t,s),extrude:(t,s={})=>this.makeExtrude(t,s)}}get add(){return{mesh:t=>this.addMesh(t),existing:t=>this.addExisting(t),plane:(t={},s={})=>this.addPlane(t,s),box:(t={},s={})=>this.addBox(t,s),ground:(t,s={})=>this.addGround(t,s),sphere:(t={},s={})=>this.addSphere(t,s),cylinder:(t={},s={})=>this.addCylinder(t,s),cone:(t={},s={})=>this.addCone(t,s),torus:(t={},s={})=>this.addTorus(t,s),extrude:(t,s={})=>this.addExtrude(t,s),material:(t={})=>this.addMaterial(t)}}addExisting(...t){this.scene!=="headless"&&this.scene.add(...t)}addMesh(t){if(Array.isArray(t))for(let s=0;s<t.length;s++)this.addExisting(t[s]);else this.addExisting(t);return this}createMesh(t,s,e){const{x:n=0,y:i=0,z:o=0}=e;let a;switch(!Array.isArray(s)&&s.type){case"LineBasicMaterial":a=new ut(t,s);break;case"PointsMaterial":a=new mt(t,s);break;default:a=new En(t,s);break}return a.position.set(n,i,o),a.castShadow=a.receiveShadow=!0,a}makeExtrude(t,s){const{x:e,y:n,z:i,name:o,shape:a,autoCenter:r=!0,breakable:c=!1,...h}=t,{depth:l=1,bevelEnabled:d=!1}=h,f=new ms(a,{depth:l,bevelEnabled:d,...h}),g=this.addMaterial(s),b=this.createMesh(f,g,{x:e,y:n,z:i});return r&&b.geometry.center(),b.name=o||`body_id_${b.id}`,b.shape="extrude",b}addExtrude(t,s={}){const e=this.makeExtrude(t,s);return this.addExisting(e),e}makePlane(t,s){const{x:e,y:n,z:i,name:o,breakable:a=!1,...r}=t,c=new fs(r.width||1,r.height||1,r.widthSegments||1,r.heightSegments||1),h=this.addMaterial(s);h.side=lt;const l=this.createMesh(c,h,{x:e,y:n,z:i});return l.name=o||`body_id_${l.id}`,l.shape="plane",l}addPlane(t,s){const e=this.makePlane(t,s);return this.addExisting(e),e}makeSphere(t,s){const{x:e,y:n,z:i,name:o,breakable:a=!1,...r}=t,c=new ps(r.radius||1,r.widthSegments||16,r.heightSegments||12,r.phiStart||void 0,r.phiLength||void 0,r.thetaStart||void 0,r.thetaLength||void 0),h=this.addMaterial(s),l=this.createMesh(c,h,{x:e,y:n,z:i});return l.name=o||`body_id_${l.id}`,l.shape="sphere",l}addSphere(t={},s={}){const e=this.makeSphere(t,s);return this.addExisting(e),e}makeBox(t,s){const{x:e,y:n,z:i,name:o,breakable:a=!1,...r}=t,c=new gs(r.width||1,r.height||1,r.depth||1,r.widthSegments||void 0,r.heightSegments||void 0,r.depthSegments||void 0),h=this.addMaterial(s),l=this.createMesh(c,h,{x:e,y:n,z:i});return l.name=o||`body_id_${l.id}`,l.shape="box",l}addBox(t={},s={}){const e=this.makeBox(t,s);return this.addExisting(e),e}addGround(t,s={}){const e=this.makeBox(t,s);return e.rotateX(pt.degToRad(90)),this.addExisting(e),e}makeCylinder(t={},s={}){const{x:e,y:n,z:i,name:o,breakable:a=!1,...r}=t,c=new ys(r.radiusTop||1,r.radiusBottom||1,r.height||1,r.radiusSegments||void 0,r.heightSegments||void 0,r.openEnded||void 0,r.thetaStart||void 0,r.thetaLength||void 0),h=this.addMaterial(s),l=this.createMesh(c,h,{x:e,y:n,z:i});return l.name=o||`body_id_${l.id}`,l.shape="cylinder",l}addCylinder(t={},s={}){const e=this.makeCylinder(t,s);return this.addExisting(e),e}makeCone(t={},s={}){const{x:e,y:n,z:i,name:o,breakable:a=!1,...r}=t,c=new bs(r.radius||1,r.height||1,r.radiusSegments||8,r.heightSegments||1,r.openEnded||!1,r.thetaStart||0,r.thetaLength||2*Math.PI),h=this.addMaterial(s),l=this.createMesh(c,h,{x:e,y:n,z:i});return l.name=o||`body_id_${l.id}`,l.shape="cone",l}addCone(t={},s={}){const e=this.makeCone(t,s);return this.addExisting(e),e}makeTorus(t={},s={}){const{x:e,y:n,z:i,name:o,breakable:a=!1,...r}=t,c=new Ts(r.radius||void 0,r.tube||void 0,r.radialSegments||void 0,r.tubularSegments||void 0,r.arc||void 0),h=this.addMaterial(s),l=this.createMesh(c,h,{x:e,y:n,z:i});return l.name=o||`body_id_${l.id}`,l.shape="torus",l}addTorus(t={},s={}){const e=this.makeTorus(t,s);return this.addExisting(e),e}addMaterial(t={}){const s=Object.keys(t)[0];let e;if(this.scene==="headless")return this.defaultMaterial.get();switch(s){case"basic":e=new se(t.basic);break;case"normal":e=new As(t.normal);break;case"standard":e=new Le(t.standard);break;case"lambert":e=new bt(t.lambert);break;case"phong":e=new xs(t.phong);break;case"physical":typeof t.physical<"u"?e=new Y(t.physical):(le("You need to pass parameters to the physical material. (Fallback to default material)"),e=this.defaultMaterial.get());break;case"toon":e=new ws(t.toon);break;case"line":e=new Me(t.line);break;case"points":e=new ct(t.points);break;case"custom":e=t.custom||this.defaultMaterial.get();break;default:e=this.defaultMaterial.get();break}return e}}const tt={type:"change"},xe={type:"start"},st={type:"end"};class Mn extends Es{constructor(t,s){super(),this.object=t,this.domElement=s,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new C,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ee.ROTATE,MIDDLE:ee.DOLLY,RIGHT:ee.PAN},this.touches={ONE:te.ROTATE,TWO:te.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(u){u.addEventListener("keydown",ve),this._domElementKeyEvents=u},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(tt),e.update(),i=n.NONE},this.update=function(){const u=new C,w=new j().setFromUnitVectors(t.up,new C(0,1,0)),N=w.clone().invert(),V=new C,H=new j,J=2*Math.PI;return function(){const Ue=e.object.position;u.copy(Ue).sub(e.target),u.applyQuaternion(w),a.setFromVector3(u),e.autoRotate&&i===n.NONE&&E(k()),e.enableDamping?(a.theta+=r.theta*e.dampingFactor,a.phi+=r.phi*e.dampingFactor):(a.theta+=r.theta,a.phi+=r.phi);let G=e.minAzimuthAngle,K=e.maxAzimuthAngle;return isFinite(G)&&isFinite(K)&&(G<-Math.PI?G+=J:G>Math.PI&&(G-=J),K<-Math.PI?K+=J:K>Math.PI&&(K-=J),G<=K?a.theta=Math.max(G,Math.min(K,a.theta)):a.theta=a.theta>(G+K)/2?Math.max(G,a.theta):Math.min(K,a.theta)),a.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(e.minDistance,Math.min(e.maxDistance,a.radius)),e.enableDamping===!0?e.target.addScaledVector(h,e.dampingFactor):e.target.add(h),u.setFromSpherical(a),u.applyQuaternion(N),Ue.copy(e.target).add(u),e.object.lookAt(e.target),e.enableDamping===!0?(r.theta*=1-e.dampingFactor,r.phi*=1-e.dampingFactor,h.multiplyScalar(1-e.dampingFactor)):(r.set(0,0,0),h.set(0,0,0)),c=1,l||V.distanceToSquared(e.object.position)>o||8*(1-H.dot(e.object.quaternion))>o?(e.dispatchEvent(tt),V.copy(e.object.position),H.copy(e.object.quaternion),l=!1,!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",Be),e.domElement.removeEventListener("pointerdown",Pe),e.domElement.removeEventListener("pointercancel",Ne),e.domElement.removeEventListener("wheel",Ve),e.domElement.removeEventListener("pointermove",ue),e.domElement.removeEventListener("pointerup",me),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",ve)};const e=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=n.NONE;const o=1e-6,a=new Ke,r=new Ke;let c=1;const h=new C;let l=!1;const d=new B,f=new B,g=new B,b=new B,y=new B,p=new B,x=new B,S=new B,A=new B,T=[],D={};function k(){return 2*Math.PI/60/60*e.autoRotateSpeed}function P(){return Math.pow(.95,e.zoomSpeed)}function E(u){r.theta-=u}function R(u){r.phi-=u}const I=function(){const u=new C;return function(N,V){u.setFromMatrixColumn(V,0),u.multiplyScalar(-N),h.add(u)}}(),_=function(){const u=new C;return function(N,V){e.screenSpacePanning===!0?u.setFromMatrixColumn(V,1):(u.setFromMatrixColumn(V,0),u.crossVectors(e.object.up,u)),u.multiplyScalar(N),h.add(u)}}(),M=function(){const u=new C;return function(N,V){const H=e.domElement;if(e.object.isPerspectiveCamera){const J=e.object.position;u.copy(J).sub(e.target);let ce=u.length();ce*=Math.tan(e.object.fov/2*Math.PI/180),I(2*N*ce/H.clientHeight,e.object.matrix),_(2*V*ce/H.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(I(N*(e.object.right-e.object.left)/e.object.zoom/H.clientWidth,e.object.matrix),_(V*(e.object.top-e.object.bottom)/e.object.zoom/H.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function O(u){e.object.isPerspectiveCamera?c/=u:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom*u)),e.object.updateProjectionMatrix(),l=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function v(u){e.object.isPerspectiveCamera?c*=u:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/u)),e.object.updateProjectionMatrix(),l=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function z(u){d.set(u.clientX,u.clientY)}function U(u){x.set(u.clientX,u.clientY)}function q(u){b.set(u.clientX,u.clientY)}function Et(u){f.set(u.clientX,u.clientY),g.subVectors(f,d).multiplyScalar(e.rotateSpeed);const w=e.domElement;E(2*Math.PI*g.x/w.clientHeight),R(2*Math.PI*g.y/w.clientHeight),d.copy(f),e.update()}function St(u){S.set(u.clientX,u.clientY),A.subVectors(S,x),A.y>0?O(P()):A.y<0&&v(P()),x.copy(S),e.update()}function Mt(u){y.set(u.clientX,u.clientY),p.subVectors(y,b).multiplyScalar(e.panSpeed),M(p.x,p.y),b.copy(y),e.update()}function Lt(u){u.deltaY<0?v(P()):u.deltaY>0&&O(P()),e.update()}function Rt(u){let w=!1;switch(u.code){case e.keys.UP:u.ctrlKey||u.metaKey||u.shiftKey?R(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):M(0,e.keyPanSpeed),w=!0;break;case e.keys.BOTTOM:u.ctrlKey||u.metaKey||u.shiftKey?R(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):M(0,-e.keyPanSpeed),w=!0;break;case e.keys.LEFT:u.ctrlKey||u.metaKey||u.shiftKey?E(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):M(e.keyPanSpeed,0),w=!0;break;case e.keys.RIGHT:u.ctrlKey||u.metaKey||u.shiftKey?E(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):M(-e.keyPanSpeed,0),w=!0;break}w&&(u.preventDefault(),e.update())}function _e(){if(T.length===1)d.set(T[0].pageX,T[0].pageY);else{const u=.5*(T[0].pageX+T[1].pageX),w=.5*(T[0].pageY+T[1].pageY);d.set(u,w)}}function Ce(){if(T.length===1)b.set(T[0].pageX,T[0].pageY);else{const u=.5*(T[0].pageX+T[1].pageX),w=.5*(T[0].pageY+T[1].pageY);b.set(u,w)}}function De(){const u=T[0].pageX-T[1].pageX,w=T[0].pageY-T[1].pageY,N=Math.sqrt(u*u+w*w);x.set(0,N)}function _t(){e.enableZoom&&De(),e.enablePan&&Ce()}function Ct(){e.enableZoom&&De(),e.enableRotate&&_e()}function Oe(u){if(T.length==1)f.set(u.pageX,u.pageY);else{const N=fe(u),V=.5*(u.pageX+N.x),H=.5*(u.pageY+N.y);f.set(V,H)}g.subVectors(f,d).multiplyScalar(e.rotateSpeed);const w=e.domElement;E(2*Math.PI*g.x/w.clientHeight),R(2*Math.PI*g.y/w.clientHeight),d.copy(f)}function Ie(u){if(T.length===1)y.set(u.pageX,u.pageY);else{const w=fe(u),N=.5*(u.pageX+w.x),V=.5*(u.pageY+w.y);y.set(N,V)}p.subVectors(y,b).multiplyScalar(e.panSpeed),M(p.x,p.y),b.copy(y)}function ke(u){const w=fe(u),N=u.pageX-w.x,V=u.pageY-w.y,H=Math.sqrt(N*N+V*V);S.set(0,H),A.set(0,Math.pow(S.y/x.y,e.zoomSpeed)),O(A.y),x.copy(S)}function Dt(u){e.enableZoom&&ke(u),e.enablePan&&Ie(u)}function Ot(u){e.enableZoom&&ke(u),e.enableRotate&&Oe(u)}function Pe(u){e.enabled!==!1&&(T.length===0&&(e.domElement.setPointerCapture(u.pointerId),e.domElement.addEventListener("pointermove",ue),e.domElement.addEventListener("pointerup",me)),Vt(u),u.pointerType==="touch"?Pt(u):It(u))}function ue(u){e.enabled!==!1&&(u.pointerType==="touch"?Nt(u):kt(u))}function me(u){Fe(u),T.length===0&&(e.domElement.releasePointerCapture(u.pointerId),e.domElement.removeEventListener("pointermove",ue),e.domElement.removeEventListener("pointerup",me)),e.dispatchEvent(st),i=n.NONE}function Ne(u){Fe(u)}function It(u){let w;switch(u.button){case 0:w=e.mouseButtons.LEFT;break;case 1:w=e.mouseButtons.MIDDLE;break;case 2:w=e.mouseButtons.RIGHT;break;default:w=-1}switch(w){case ee.DOLLY:if(e.enableZoom===!1)return;U(u),i=n.DOLLY;break;case ee.ROTATE:if(u.ctrlKey||u.metaKey||u.shiftKey){if(e.enablePan===!1)return;q(u),i=n.PAN}else{if(e.enableRotate===!1)return;z(u),i=n.ROTATE}break;case ee.PAN:if(u.ctrlKey||u.metaKey||u.shiftKey){if(e.enableRotate===!1)return;z(u),i=n.ROTATE}else{if(e.enablePan===!1)return;q(u),i=n.PAN}break;default:i=n.NONE}i!==n.NONE&&e.dispatchEvent(xe)}function kt(u){switch(i){case n.ROTATE:if(e.enableRotate===!1)return;Et(u);break;case n.DOLLY:if(e.enableZoom===!1)return;St(u);break;case n.PAN:if(e.enablePan===!1)return;Mt(u);break}}function Ve(u){e.enabled===!1||e.enableZoom===!1||i!==n.NONE||(u.preventDefault(),e.dispatchEvent(xe),Lt(u),e.dispatchEvent(st))}function ve(u){e.enabled===!1||e.enablePan===!1||Rt(u)}function Pt(u){switch(He(u),T.length){case 1:switch(e.touches.ONE){case te.ROTATE:if(e.enableRotate===!1)return;_e(),i=n.TOUCH_ROTATE;break;case te.PAN:if(e.enablePan===!1)return;Ce(),i=n.TOUCH_PAN;break;default:i=n.NONE}break;case 2:switch(e.touches.TWO){case te.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;_t(),i=n.TOUCH_DOLLY_PAN;break;case te.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ct(),i=n.TOUCH_DOLLY_ROTATE;break;default:i=n.NONE}break;default:i=n.NONE}i!==n.NONE&&e.dispatchEvent(xe)}function Nt(u){switch(He(u),i){case n.TOUCH_ROTATE:if(e.enableRotate===!1)return;Oe(u),e.update();break;case n.TOUCH_PAN:if(e.enablePan===!1)return;Ie(u),e.update();break;case n.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Dt(u),e.update();break;case n.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ot(u),e.update();break;default:i=n.NONE}}function Be(u){e.enabled!==!1&&u.preventDefault()}function Vt(u){T.push(u)}function Fe(u){delete D[u.pointerId];for(let w=0;w<T.length;w++)if(T[w].pointerId==u.pointerId){T.splice(w,1);return}}function He(u){let w=D[u.pointerId];w===void 0&&(w=new B,D[u.pointerId]=w),w.set(u.pageX,u.pageY)}function fe(u){const w=u.pointerId===T[0].pointerId?T[1]:T[0];return D[w.pointerId]}e.domElement.addEventListener("contextmenu",Be),e.domElement.addEventListener("pointerdown",Pe),e.domElement.addEventListener("pointercancel",Ne),e.domElement.addEventListener("wheel",Ve,{passive:!1}),this.update()}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */class Ln{constructor(t,s){this.physics=t,this.ammo=s,this.ignoreScale=!1,this.isSoftBody=!1,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.impact=[],this.breakable=!1,this.fractureImpulse=1,this.didUpdate=!1,this.skipUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpEuler=new Tt,this.tmpQuaternion=new j,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtVector3_1=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.eventEmitter=new he,this.name=s.name}destructor(){this.eventEmitter&&this.eventEmitter.removeAllListeners(),Ammo.destroy(this.tmpBtVector3),Ammo.destroy(this.tmpBtVector3_1),Ammo.destroy(this.tmpBtQuaternion),Ammo.destroy(this.ammo.getCollisionShape()),Ammo.destroy(this.ammo)}setupEventEmitter(){typeof this.eventEmitter>"u"&&(this.eventEmitter=new he)}get needUpdate(){return this._needUpdate}set needUpdate(t){!t&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=t}onUpdateEvent(t,s=!1){this.setupEventEmitter(),this._emitUpdateEvents=!0,s?this.eventEmitter.once("update",()=>{t()}):this.eventEmitter.on("update",()=>{t()})}get on(){return{update:t=>this.onUpdateEvent(t),collision:t=>this.onCollision(t)}}get once(){return{update:t=>this.onUpdateEvent(t,!0)}}onCollision(t){this.checkCollisions=!0,this.physics.collisionEvents.on("collision",s=>{const{bodies:e,event:n}=s;e[0].name===this.name?t(e[1],n):e[1].name===this.name&&t(e[0],n)})}transform(){const t=this.physics.worldTransform;this.ammo.getMotionState().getWorldTransform(t)}refresh(){const t=this.physics.worldTransform;this.ammo.getMotionState().setWorldTransform(t)}setRotation(t,s,e){const n=this.tmpEuler.set(t,s,e),i=this.tmpQuaternion.set(0,0,0,1);i.setFromEuler(n),this.tmpBtQuaternion.setValue(0,0,0,1);const o=this.tmpBtQuaternion;o.setValue(i.x,i.y,i.z,i.w),this.physics.worldTransform.setRotation(o)}get rotation(){let t,s,e;const i=this.physics.worldTransform.getRotation();let o=this.tmpQuaternion.set(i.x(),i.y(),i.z(),i.w());o.w>1&&(o=o.normalize());const a=2*Math.acos(o.w),r=Math.sqrt(1-o.w*o.w);return r<.001?(t=o.x,s=o.y,e=o.z):(t=o.x/r,s=o.y/r,e=o.z/r),{x:t*a,y:s*a,z:e*a}}get quaternion(){const s=this.physics.worldTransform.getRotation();return{x:s.x(),y:s.y(),z:s.z(),w:s.w()}}setPosition(t,s,e){this.physics.worldTransform.getOrigin().setValue(t,s,e)}get position(){const t=this.physics.worldTransform;return{x:t.getOrigin().x(),y:t.getOrigin().y(),z:t.getOrigin().z()}}get velocity(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}}get angularVelocity(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}}setVelocity(t,s,e){this.tmpBtVector3.setValue(t,s,e),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityX(t){this.tmpBtVector3.setValue(t,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityY(t){this.tmpBtVector3.setValue(this.velocity.x,t,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityZ(t){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,t),this.ammo.setLinearVelocity(this.tmpBtVector3)}setAngularVelocity(t,s,e){this.tmpBtVector3.setValue(t,s,e),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityX(t){this.tmpBtVector3.setValue(t,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityY(t){this.tmpBtVector3.setValue(this.angularVelocity.x,t,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityZ(t){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,t),this.ammo.setAngularVelocity(this.tmpBtVector3)}applyForce(t,s,e){this.tmpBtVector3.setValue(t,s,e),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceX(t){this.tmpBtVector3.setValue(t,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceY(t){this.tmpBtVector3.setValue(0,t,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceZ(t){this.tmpBtVector3.setValue(0,0,t),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralForce(t,s,e){this.tmpBtVector3.setValue(t,s,e),this.ammo.applyCentralForce(this.tmpBtVector3)}applyCentralImpulse(t,s,e){this.tmpBtVector3.setValue(t,s,e),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralLocalForce(t,s,e){this.tmpBtVector3.setValue(t,s,e),this.ammo.applyCentralLocalForce(this.tmpBtVector3)}applyImpulse(t,s){this.tmpBtVector3.setValue(t.x||0,t.y||0,t.z||0),this.tmpBtVector3_1.setValue(s.x||0,s.y||0,s.z||0),this.ammo.applyImpulse(this.tmpBtVector3,this.tmpBtVector3_1)}applyLocalTorque(t,s,e){this.tmpBtVector3.setValue(t,s,e),this.ammo.applyLocalTorque(this.tmpBtVector3)}applyTorque(t,s,e){this.tmpBtVector3.setValue(t,s,e),this.ammo.applyTorque(this.tmpBtVector3)}applyTorqueImpulse(t,s,e){this.tmpBtVector3.setValue(t,s,e),this.ammo.applyTorqueImpulse(this.tmpBtVector3)}setCollisionFlags(t){this.ammo.setCollisionFlags(t)}getCollisionFlags(){return this.ammo.getCollisionFlags()}setRestitution(t){this.ammo.setRestitution(t)}setBounciness(t){this.setRestitution(t)}setFriction(t){this.ammo.setFriction(t)}setDamping(t,s){this.ammo.setDamping(t,s)}setGravity(t,s,e){this.tmpBtVector3.setValue(t,s,e),this.ammo.setGravity(this.tmpBtVector3)}setLinearFactor(t,s,e){this.tmpBtVector3.setValue(t,s,e),this.ammo.setLinearFactor(this.tmpBtVector3)}setAngularFactor(t,s,e){this.tmpBtVector3.setValue(t,s,e),this.ammo.setAngularFactor(this.tmpBtVector3)}setCcdMotionThreshold(t){this.ammo.setCcdMotionThreshold(t)}setCcdSweptSphereRadius(t){this.ammo.setCcdSweptSphereRadius(t)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */class Rn{constructor(t,s){this.factory=t,this.addExisting=s}addPlane(t={},s={}){const e=this.factory.add.plane(t,s);return this.addExisting(e,t),e}addSphere(t={},s={}){const e=this.factory.add.sphere(t,s);return this.addExisting(e,t),e}addBox(t={},s={}){const e=this.factory.add.box(t,s);return this.addExisting(e,t),e}addGround(t,s={}){const e=this.factory.add.ground(t,s),n={...t,mass:0,collisionFlags:1};return this.addExisting(e,n),e}addCylinder(t={},s={}){const e=this.factory.add.cylinder(t,s);return this.addExisting(e,t),e}addCone(t={},s={}){const e=this.factory.add.cone(t,s);return this.addExisting(e,t),e}addTorus(t={},s={}){const e=this.factory.add.torus(t,s);return this.addExisting(e,t),e}addExtrude(t,s={}){const e=this.factory.add.extrude(t,s);return e.translateX(1),this.addExisting(e),e}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */class _n{constructor(t,s){this.worldTransform=t,this.physicsWorld=s,this.tmpBtVector3=new Ammo.btVector3}toAmmoV3(t,s=0){return new Ammo.btVector3(typeof(t==null?void 0:t.x)<"u"?t.x:s,typeof(t==null?void 0:t.y)<"u"?t.y:s,typeof(t==null?void 0:t.z)<"u"?t.z:s)}get addConstraints(){return{lock:(t,s,e)=>this.lock(t,s,e),fixed:(t,s,e)=>this.fixed(t,s,e),pointToPoint:(t,s,e,n)=>this.pointToPoint(t,s,e,n),hinge:(t,s,e,n)=>this.hinge(t,s,e,n),slider:(t,s,e={},n)=>this.slider(t,s,e,n),spring:(t,s,e={},n)=>this.spring(t,s,e,n),coneTwist:(t,s,e={frameA:{},frameB:{}},n)=>this.coneTwist(t,s,e,n),dof:(t,s,e,n)=>this.dof(t,s,e,n)}}getTransform(t,s,e={x:0,y:0,z:0},n=!1){e={x:0,y:0,z:0,...e};const i=(a,r)=>{var c=(a.x()-r.x())/2+e.x,h=(a.y()-r.y())/2+e.y,l=(a.z()-r.z())/2+e.z;return new Ammo.btVector3(c,h,l)},o=new Ammo.btTransform;if(o.setIdentity(),n){const a=i(t.getWorldTransform().getOrigin(),s.getWorldTransform().getOrigin()),r=new Ammo.btTransform;r.setIdentity(),r.setOrigin(a);const c=t.getCenterOfMassTransform().inverse().op_mul(s.getWorldTransform());return c.op_mul(r),{transformA:c,transformB:r}}else return o.setOrigin(new Ammo.btVector3(e.x,e.y,e.z)),{transformA:t.getCenterOfMassTransform().inverse().op_mul(s.getWorldTransform()).op_mul(o),transformB:o}}lock(t,s,e=!0){const n={x:0,y:0,z:0};return this.dof(t,s,{angularLowerLimit:n,angularUpperLimit:n},e)}fixed(t,s,e=!0){const n=this.getTransform(t.ammo,s.ammo);n.transformA.setRotation(t.ammo.getWorldTransform().getRotation()),n.transformB.setRotation(s.ammo.getWorldTransform().getRotation());const i=new Ammo.btFixedConstraint(t.ammo,s.ammo,n.transformA,n.transformB);return this.physicsWorld.addConstraint(i,e),i}pointToPoint(t,s,e={},n=!0){const{pivotA:i,pivotB:o}=e,a=new Ammo.btVector3((i==null?void 0:i.x)||0,(i==null?void 0:i.y)||0,(i==null?void 0:i.z)||0),r=new Ammo.btVector3((o==null?void 0:o.x)||0,(o==null?void 0:o.y)||0,(o==null?void 0:o.z)||0),c=new Ammo.btPoint2PointConstraint(t.ammo,s.ammo,a,r);return this.physicsWorld.addConstraint(c,n),c}hinge(t,s,e={},n=!0){const{pivotA:i,pivotB:o,axisA:a,axisB:r}=e,c=new Ammo.btVector3((i==null?void 0:i.x)||0,(i==null?void 0:i.y)||0,(i==null?void 0:i.z)||0),h=new Ammo.btVector3((o==null?void 0:o.x)||0,(o==null?void 0:o.y)||0,(o==null?void 0:o.z)||0),l=new Ammo.btVector3((a==null?void 0:a.x)||0,(a==null?void 0:a.y)||0,(a==null?void 0:a.z)||0),d=new Ammo.btVector3((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),f=new Ammo.btHingeConstraint(t.ammo,s.ammo,c,h,l,d,!0);return this.physicsWorld.addConstraint(f,n),f}slider(t,s,e={},n=!0){const i=this.getTransform(t.ammo,s.ammo),{frameA:o={},frameB:a={},linearLowerLimit:r=0,linearUpperLimit:c=0,angularLowerLimit:h=0,angularUpperLimit:l=0}=e,d=i.transformA.getRotation();d.setEulerZYX(o.x||0,o.y||0,o.z||0),i.transformA.setRotation(d);const f=i.transformB.getRotation();f.setEulerZYX(a.x||0,a.y||0,a.z||0),i.transformB.setRotation(f);const g=new Ammo.btSliderConstraint(t.ammo,s.ammo,i.transformA,i.transformB,!0);return g.setLowerLinLimit(r),g.setUpperLinLimit(c),g.setLowerAngLimit(h),g.setUpperAngLimit(l),this.physicsWorld.addConstraint(g,n),g}spring(t,s,e={},n=!0){const{stiffness:i=50,damping:o=.01,angularLock:a=!1,linearLowerLimit:r={},linearUpperLimit:c={},angularLowerLimit:h={},angularUpperLimit:l={},offset:d={},center:f=!1,enableSpring:g=!0}=e,b={x:0,y:0,z:0,...d},y=this.getTransform(t.ammo,s.ammo,b,f),p=new Ammo.btGeneric6DofSpringConstraint(t.ammo,s.ammo,y.transformA,y.transformB,!0);this.tmpBtVector3.setValue(r.x||0,r.y||0,r.z||0),p.setLinearLowerLimit(this.tmpBtVector3),this.tmpBtVector3.setValue(c.x||0,c.y||0,c.z||0),p.setLinearUpperLimit(this.tmpBtVector3),a?(this.tmpBtVector3.setValue(0,0,0),p.setAngularLowerLimit(this.tmpBtVector3),p.setAngularUpperLimit(this.tmpBtVector3)):(console.log(h,l),p.setAngularLowerLimit(this.toAmmoV3(h,-Math.PI)),p.setAngularUpperLimit(this.toAmmoV3(l,Math.PI)));for(let x=0;x<3;x++)p.enableSpring(x,g),p.setStiffness(x,i),p.setDamping(x,o);return this.physicsWorld.addConstraint(p,n),p}coneTwist(t,s,e,n=!0){const{frameA:i,frameB:o}=e,a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue((i==null?void 0:i.x)||0,(i==null?void 0:i.y)||0,(i==null?void 0:i.z)||0);const r=new Ammo.btTransform;r.setIdentity(),r.getOrigin().setValue((o==null?void 0:o.x)||0,(o==null?void 0:o.y)||0,(o==null?void 0:o.z)||0),this.getTransform(t.ammo,s.ammo);const c=new Ammo.btConeTwistConstraint(s.ammo,t.ammo,a,r);return c.setAngularOnly(!0),this.physicsWorld.addConstraint(c,n),c}dof(t,s,e={},n=!0){const{offset:i,center:o=!1}=e,a={x:0,y:0,z:0,...i},r=this.getTransform(t.ammo,s.ammo,a,o),c=new Ammo.btGeneric6DofConstraint(t.ammo,s.ammo,r.transformA,r.transformB,!0),{linearLowerLimit:h,linearUpperLimit:l,angularLowerLimit:d,angularUpperLimit:f}=e,g=this.toAmmoV3(h),b=this.toAmmoV3(l),y=this.toAmmoV3(d,-Math.PI),p=this.toAmmoV3(f,Math.PI);return c.setLinearLowerLimit(g),c.setLinearUpperLimit(b),c.setAngularLowerLimit(y),c.setAngularUpperLimit(p),Ammo.destroy(g),Ammo.destroy(b),Ammo.destroy(y),Ammo.destroy(p),this.physicsWorld.addConstraint(c,n),c}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */const Cn=(m,t)=>{const{radius:s=1,tube:e=.4,tubularSegments:n=8}=m,i=Math.PI,o=n,a=Math.sqrt(2*e*e-2*e*e*Math.cos(2*i/o)),r=new Ammo.btVector3(e,i/o+.5*a,e),c=new Ammo.btCylinderShape(r);c.setMargin(.05);const h=new Ammo.btCompoundShape,l=new Ammo.btVector3(0,0,1),d=new Ammo.btVector3(0,s,0),f=new Ammo.btQuaternion(t.x,t.y,t.z,t.w);for(let g=0;g<o;g++){const b=g*2*i/o,y=d.rotate(l,b),p=new Ammo.btTransform;f.setRotation(l,b+Math.PI/2),p.setIdentity(),p.setOrigin(y),p.setRotation(f),h.addChildShape(p,c)}return h};/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */class Dn extends he{addCollider(t,s,e){!t.body||!s.body||(t.body.checkCollisions=!0,s.body.checkCollisions=!0,this.on("collision",n=>{var a,r;const{bodies:i,event:o}=n;(a=i[0])!=null&&a.name&&((r=i[1])!=null&&r.name)&&(t!=null&&t.name)&&(s!=null&&s.name)&&(i[0].name===t.name&&i[1].name===s.name||i[1].name===t.name&&i[0].name===s.name)&&e(o)}))}}/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer
 * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}
 */const nt={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:1<<11,DrawConstraintLimits:1<<12,FastWireframe:1<<13,DrawNormals:1<<14,DrawOnTop:1<<15,MAX_DEBUG_DRAW_MODE:4294967295};class On{constructor(t,s,e={}){this.scene=t,this.world=s,this.options=e,this.debugDrawMode=e.debugDrawMode||nt.DrawWireframe;const n=this.debugDrawMode&nt.DrawOnTop||!1,i=e.maxBufferSize||1e6;this.geometry=new Re;const o=new Float32Array(i*3),a=new Float32Array(i*3);this.geometry.setAttribute("position",new re(o,3).setUsage(je)),this.geometry.setAttribute("color",new re(a,3).setUsage(je)),this.index=0;const r=new Me({vertexColors:!0,depthTest:!n});this.mesh=new dt(this.geometry,r),n&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}enable(){this.enabled=!0,this.scene.add(this.mesh)}disable(){this.enabled=!1,this.scene.remove(this.mesh)}update(){this.enabled&&(this.index!=0&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))}drawLine(t,s,e){const n=Ammo.HEAPF32,i=n[(e+0)/4],o=n[(e+4)/4],a=n[(e+8)/4],r=n[(t+0)/4],c=n[(t+4)/4],h=n[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,r,c,h),this.geometry.attributes.color.setXYZ(this.index++,i,o,a);const l=n[(s+0)/4],d=n[(s+4)/4],f=n[(s+8)/4];this.geometry.attributes.position.setXYZ(this.index,l,d,f),this.geometry.attributes.color.setXYZ(this.index++,i,o,a)}drawContactPoint(t,s,e,n,i){const o=Ammo.HEAPF32,a=o[(i+0)/4],r=o[(i+4)/4],c=o[(i+8)/4],h=o[(t+0)/4],l=o[(t+4)/4],d=o[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,h,l,d),this.geometry.attributes.color.setXYZ(this.index++,a,r,c);const f=o[(s+0)/4]*e,g=o[(s+4)/4]*e,b=o[(s+8)/4]*e;this.geometry.attributes.position.setXYZ(this.index,h+f,l+g,d+b),this.geometry.attributes.color.setXYZ(this.index++,a,r,c)}reportErrorWarning(t){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(t)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))}draw3dText(t,s){console.warn("TODO: draw3dText")}setDebugMode(t){this.debugDrawMode=t}getDebugMode(){return this.debugDrawMode}}const In=(m,t)=>{typeof window<"u"&&(window.__loadPhysics=!0),Ds(m,()=>{Ammo().then(()=>{t()})})};/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */class kn extends he{constructor(t,s={}){super(),this.scene=t,this.config=s,this.rigidBodies=[],this.earlierDetectedCollisions=[],this.complexShapes=["plane","hull","hacd","vhacd","convexMesh","concaveMesh"],this.gravity=s.gravity||{x:0,y:-9.81,z:0},this.isHeadless=t==="headless",this.tmpEuler=new Tt,this.tmpQuaternion=new j,this.tmpVector3=new C,this.tmpVector3a=new C,this.tmpMatrix4=new Z,this.tmpMatrix4a=new Z,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.emptyV3=new C,this.impactPoint=new C,this.impactNormal=new C,t!=="headless"&&(this.defaultMaterial=new At),this.start()}get tmpTrans(){return console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform}set tmpTrans(t){console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform=t}destroy(t){var i;const s=Object.keys(t).includes("body")?t.body:t;if(typeof(s==null?void 0:s.ammo)>"u")return;let e=s.ammo.threeObject;const n=e.name;if(n&&e&&(i=e==null?void 0:e.body)!=null&&i.ammo){e.body.isSoftBody?this.physicsWorld.removeSoftBody(e.body.ammo):this.physicsWorld.removeRigidBody(e.body.ammo),e.body.destructor(),e.body=void 0,e.hasBody=!1,delete s.ammo.threeObject;for(let o=0;o<this.rigidBodies.length;o++)this.rigidBodies[o].name===n&&(this.rigidBodies.splice(o,1),o--)}this.scene==="headless"&&e&&(e=null)}setup(){if(this.worldTransform=new Ammo.btTransform,typeof this.config.setupPhysicsWorld=="function"?this.physicsWorld=this.config.setupPhysicsWorld():this.physicsWorld=this.setupPhysicsWorld(),this.scene!=="headless"){this.convexBreaker=new Os,this.objectsToRemove=[],this.numObjectsToRemove=0;for(let t=0;t<500;t++)this.objectsToRemove[t]=null}this.collisionEvents=new Dn,this.factory=new Sn(this.scene),this.shapes=new Rn(this.factory,(t,s)=>this.addExisting(t,s)),this.constraints=new _n(this.worldTransform,this.physicsWorld),this.scene!=="headless"&&(this.debugDrawer=new On(this.scene,this.physicsWorld,{}))}updateDebugger(){this.scene!=="headless"&&this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()}setupPhysicsWorld(){const t=this.gravity,{softBodies:s=!1}=this.config;let e;if(!s){const n=new Ammo.btDefaultCollisionConfiguration,i=new Ammo.btCollisionDispatcher(n),o=new Ammo.btDbvtBroadphase,a=new Ammo.btSequentialImpulseConstraintSolver;e=new Ammo.btDiscreteDynamicsWorld(i,o,a,n)}if(s){const n=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,i=new Ammo.btCollisionDispatcher(n),o=new Ammo.btDbvtBroadphase,a=new Ammo.btSequentialImpulseConstraintSolver,r=new Ammo.btDefaultSoftBodySolver;e=new Ammo.btSoftRigidDynamicsWorld(i,o,a,n,r)}return e.setGravity(new Ammo.btVector3(t.x,t.y,t.z)),e}createDebrisFromBreakableObject(t,s){this.scene!=="headless"&&(t.material=s.material,t.shape="hull",t.fragmentDepth=s.fragmentDepth+1,t.name=`${s.name}__DEBRIS_${t.id}`,this.scene.add(t),this.addExisting(t,{autoCenter:!0}),t.body.fractureImpulse=s.body.fractureImpulse,t.body.breakable=!1,setTimeout(()=>{t.body.breakable=!0},2500))}removeDebris(t){this.scene!=="headless"&&(this.scene.remove(t),this.destroy(t))}update(t){this.updatePhysics(t),this.detectCollisions()}updatePhysics(t){const s=t/1e3;this.physicsWorld.stepSimulation(s,this.config.maxSubSteps||4,this.config.fixedTimeStep||1/60);for(let e=0;e<this.rigidBodies.length;e++){const n=this.rigidBodies[e];n.body.impact=[];const o=n.body.ammo.getMotionState();if(o){if(o.getWorldTransform(this.worldTransform),n.body.didUpdate&&(n.body._emitUpdateEvents&&n.body.eventEmitter.emit("update"),n.body.didUpdate=!1),n.body.ammo.isKinematicObject()&&n.body.needUpdate)n.getWorldQuaternion(this.tmpQuaternion),n.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.worldTransform.setOrigin(this.tmpBtVector3),this.worldTransform.setRotation(this.tmpBtQuaternion),o.setWorldTransform(this.worldTransform),n.body.needUpdate=!1;else if(!n.body.skipUpdate){if(!n.body.ammo.isStaticObject()){const a=this.worldTransform.getOrigin(),r=this.worldTransform.getRotation(),c=n.body.offset;if(n.body.ignoreScale)this.tmpVector3a.set(n.scale.x,n.scale.y,n.scale.z);else{const h=n.body.ammo.getCollisionShape().getLocalScaling();this.tmpVector3a.set(h.x(),h.y(),h.z())}this.tmpVector3.set(a.x()+c.x,a.y()+c.y,a.z()+c.z),this.tmpQuaternion.set(r.x(),r.y(),r.z(),r.w()),this.tmpMatrix4.compose(this.tmpVector3,this.tmpQuaternion,this.tmpVector3a),n.parent?parseInt(Ss)>=123?this.tmpMatrix4a.copy(n.parent.matrixWorld).invert():this.tmpMatrix4a.getInverse(n.parent.matrixWorld):this.tmpMatrix4a.identity(),this.tmpMatrix4a.multiply(this.tmpMatrix4),this.tmpMatrix4a.decompose(n.position,n.quaternion,n.scale)}}}}}detectCollisions(){var n,i;const t=[];this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);const s=this.physicsWorld.getDispatcher(),e=s.getNumManifolds();for(let o=0;o<e;o++){const a=s.getManifoldByIndexInternal(o),r=a.getNumContacts(),c=Ammo.castObject(a.getBody0(),Ammo.btRigidBody),h=Ammo.castObject(a.getBody1(),Ammo.btRigidBody),l=c.threeObject,d=h.threeObject;if(!l||!d||c.name===""&&h.name==="")continue;const f=(n=l.body)==null?void 0:n.checkCollisions,g=(i=d.body)==null?void 0:i.checkCollisions,b=l.body.breakable,y=d.body.breakable,p=l.body.fractureImpulse,x=d.body.fractureImpulse,S=f||g,A=b||y;if(typeof l.fragmentDepth>"u"&&(l.fragmentDepth=0),typeof d.fragmentDepth>"u"&&(d.fragmentDepth=0),!S&&!A)continue;let T=!1,D=0,k="start";for(let E=0;E<r;E++){const R=a.getContactPoint(E);if(R.getDistance()<=0){T=!0;const _=R.getAppliedImpulse(),M=R.get_m_positionWorldOnB(),O=R.get_m_normalWorldOnB();if(f||g){const v=[l.uuid,d.uuid].sort(),z=`${v[0]}__${v[1]}`;if(this.earlierDetectedCollisions.find(U=>U.combinedName===z)&&(k="collision"),!t.find(U=>U.combinedName===z)){t.push({combinedName:z,collision:!0});const U={x:M.x(),y:M.y(),z:M.z()},q={x:O.x(),y:O.y(),z:O.z()};l.body.impact.push({impulse:_,point:U,normal:q,name:d.name}),d.body.impact.push({impulse:_,point:U,normal:q,name:l.name}),this.collisionEvents.emit("collision",{bodies:[l,d],event:k})}}_>=D&&(D=_,(b||y)&&(this.impactPoint.set(M.x(),M.y(),M.z()),this.impactNormal.set(O.x(),O.y(),O.z())));break}}if(!T||!A)continue;const P=2;if(this.emptyV3.set(0,0,0),l.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:b,physicsBody:c},d.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:y,physicsBody:h},b&&D>p&&l.fragmentDepth<P){const E=this.convexBreaker.subdivideByImpact(l,this.impactPoint,this.impactNormal,1,2),R=E.length;for(let I=0;I<R;I++){const _=c.getLinearVelocity(),M=c.getAngularVelocity(),O=E[I];O.userData.ammoPhysicsData.velocity.set(_.x(),_.y(),_.z()),O.userData.ammoPhysicsData.angularVelocity.set(M.x(),M.y(),M.z()),this.createDebrisFromBreakableObject(O,l)}this.objectsToRemove[this.numObjectsToRemove++]=l}if(y&&D>x&&d.fragmentDepth<P){const E=this.convexBreaker.subdivideByImpact(d,this.impactPoint,this.impactNormal,1,2),R=E.length;for(let I=0;I<R;I++){const _=h.getLinearVelocity(),M=h.getAngularVelocity(),O=E[I];O.userData.ammoPhysicsData.velocity.set(_.x(),_.y(),_.z()),O.userData.ammoPhysicsData.angularVelocity.set(M.x(),M.y(),M.z()),this.createDebrisFromBreakableObject(O,d)}this.objectsToRemove[this.numObjectsToRemove++]=d}}for(let o=0;o<this.numObjectsToRemove;o++)this.removeDebris(this.objectsToRemove[o]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach(o=>{const{combinedName:a}=o;if(!t.find(r=>r.combinedName===a)){const r=a.split("__"),c=this.rigidBodies.find(d=>d.uuid===r[0]),h=this.rigidBodies.find(d=>d.uuid===r[1]),l="end";c&&h&&this.collisionEvents.emit("collision",{bodies:[c,h],event:l})}}),this.earlierDetectedCollisions=[...t]}setGravity(t=0,s=-9.8,e=0){this.tmpBtVector3.setValue(t,s,e),this.physicsWorld.setGravity(this.tmpBtVector3)}get debug(){return this.isHeadless?null:{enable:()=>{this.debugDrawer.enable()},mode:(t=1)=>{this.debugDrawer.setDebugMode(t)},disable:()=>{this.debugDrawer.disable()}}}start(){if(typeof Ammo>"u"){le("Are you sure you included ammo.js?");return}typeof Ammo=="function"?Ammo().then(()=>{this.setup()}):this.setup()}get add(){return{collider:(t,s,e)=>this.collisionEvents.addCollider(t,s,e),constraints:this.constraints.addConstraints,existing:(t,s)=>this.addExisting(t,s),plane:(t={},s={})=>this.shapes.addPlane(t,s),sphere:(t={},s={})=>this.shapes.addSphere(t,s),ground:(t={},s={})=>this.shapes.addGround(t,s),box:(t={},s={})=>this.shapes.addBox(t,s),cylinder:(t={},s={})=>this.shapes.addCylinder(t,s),cone:(t={},s={})=>this.shapes.addCone(t,s),torus:(t={},s={})=>this.shapes.addTorus(t,s),extrude:(t,s={})=>this.shapes.addExtrude(t,s),raycaster:(t="closest")=>t==="closest"?new Is(this):new ks(this)}}prepareThreeObjectForCollisionShape(t,s={}){var r,c;const{autoCenter:e=!1}=s,n={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6};let i="unknown";const o=((r=t.geometry)==null?void 0:r.type)||"unknown";/box/i.test(o)?i="box":/cone/i.test(o)?i="cone":/cylinder/i.test(o)?i="cylinder":/extrude/i.test(o)?i="extrude":/plane/i.test(o)?i="plane":/sphere/i.test(o)?i="sphere":/torus/i.test(o)&&(i="torus");let a={...n,...(c=t==null?void 0:t.geometry)==null?void 0:c.parameters};return s.shape?(a={...n,...s},i=s.shape):t.shape&&(i=t.shape),Object.keys(a).forEach(h=>{typeof a[h]>"u"&&n[h]&&(a[h]=n[h])}),e&&t.geometry.center(),i==="cylinder"&&(a.radius=s.radius||a.radiusTop),i==="extrude"&&(i="hacd"),(i==="mesh"||i==="convex")&&(i="convexMesh"),i==="concave"&&(i="concaveMesh"),i==="unknown"&&(le(`Shape for ${t==null?void 0:t.name} not recognized! Will fallback to box.`),i="box"),{shape:i,params:a,object:t}}createCollisionShape(t,s,e){const n=e!=null&&e.quaternion?e==null?void 0:e.quaternion:new j(0,0,0,1),{axis:i="y"}=s,o=new Ammo.btVector3,a=e==null?void 0:e.geometry;e&&(a!=null&&a.isGeometry)&&(e.geometry=new Re().fromGeometry(a));const r=g=>{const b=new Z().elements,y=[],p=[],x=[];return vs(g,{},(S,A,T)=>{y.push(S),p.push(A),x.push(T)}),{vertices:y,matrices:p,indexes:x,matrixWorld:b}};let c={};this.complexShapes.indexOf(t)!==-1&&(c=r(e));let h;switch(t){case"box":o.setValue(s.width/2,s.height/2,s.depth/2),h=new Ammo.btBoxShape(o);break;case"sphere":h=new Ammo.btSphereShape(s.radius);break;case"cylinder":switch(i){case"y":o.setValue(s.radius,s.height/2,s.radius),h=new Ammo.btCylinderShape(o);break;case"x":o.setValue(s.height/2,s.radius,s.radius),h=new Ammo.btCylinderShapeX(o);break;case"z":o.setValue(s.radius,s.radius,s.height/2),h=new Ammo.btCylinderShapeZ(o);break}break;case"cone":switch(i){case"y":h=new Ammo.btConeShape(s.radius,s.height);break;case"x":h=new Ammo.btConeShapeX(s.radius,s.height);break;case"z":h=new Ammo.btConeShapeZ(s.radius,s.height);break}break;case"capsule":switch(i){case"y":h=new Ammo.btCapsuleShape(s.radius,s.height);break;case"x":h=new Ammo.btCapsuleShapeX(s.radius,s.height);break;case"z":h=new Ammo.btCapsuleShapeZ(s.radius,s.height);break}break;case"torus":h=Cn(s,n);break;case"plane":h=ye(c.vertices,c.matrices,c.indexes,c.matrixWorld,{...s,concave:!1});break;case"hull":h=Vs(c.vertices,c.matrices,c.matrixWorld,s);break;case"hacd":h=Ns(c.vertices,c.matrices,c.indexes,c.matrixWorld,s);break;case"vhacd":h=Ps(c.vertices,c.matrices,c.indexes,c.matrixWorld,s);break;case"convexMesh":h=ye(c.vertices,c.matrices,c.indexes,c.matrixWorld,{...s,concave:!1});break;case"concaveMesh":h=ye(c.vertices,c.matrices,c.indexes,c.matrixWorld,{...s,concave:!0});break}Ammo.destroy(o);const{x:l,y:d,z:f}=s;return(l||d||f)&&(h._compoundOffset={x:l||0,y:d||0,z:f||0}),Array.isArray(h)&&(h=this.mergeCollisionShapesToCompoundShape(h)),h}mergeCollisionShapesToCompoundShape(t){const s=new Ammo.btCompoundShape;return t.forEach(e=>{const{_childOffset:n,_compoundOffset:i}=e;if(n){const{pos:o,quat:a,scale:r,margin:c}=n,h=this.applyPosQuatScaleMargin(e,o,a,r,c);s.addChildShape(h,e)}else if(i){const o=new Ammo.btTransform;o.setIdentity(),o.setOrigin(new Ammo.btVector3(i.x,i.y,i.z)),s.addChildShape(o,e)}else{const o=new Ammo.btTransform;o.setIdentity(),s.addChildShape(o,e)}}),s}addExisting(t,s={}){const{hasBody:e}=t;if(e){le(`Object "${t.name}" already has a physical body!`);return}const n=new C,i=new j,o=new C;t.getWorldPosition(n),t.getWorldQuaternion(i),t.getWorldScale(o);const a=(s.collisionFlags||0).toString(2).slice(-1)==="1",r=(s.collisionFlags||0).toString(2).slice(-2,-1)==="1",{shape:c="unknown",compound:h=[],mass:l=a||r?0:1,collisionFlags:d=0,collisionGroup:f=1,collisionMask:g=-1,offset:b=void 0,breakable:y=!1,addChildren:p=!0,margin:x=.01,ignoreScale:S=!1,fractureImpulse:A=1}=s;if(S&&o.set(1,1,1),h.length>=1){const E=h.map(M=>this.createCollisionShape(M.shape,M)),R=this.mergeCollisionShapesToCompoundShape(E),I=this.applyPosQuatScaleMargin(R,n,i,o,x),_=this.collisionShapeToRigidBody(R,I,l,r);this.addRigidBodyToWorld(t,_,d,f,g,b),t.body.breakable=y,t.body.fractureImpulse=A,t.body.ignoreScale=S;return}const T=[];if(c!=="unknown"||t.isMesh){const E=this.prepareThreeObjectForCollisionShape(t,s),R=this.createCollisionShape(E.shape,E.params,E.object);T.push(R)}if(c==="unknown"&&p&&t.children.length>=1&&t.children.forEach(E=>{if(E.isMesh){const R=this.prepareThreeObjectForCollisionShape(E),I=this.createCollisionShape(R.shape,R.params,R.object);I._childOffset={pos:E.position.clone(),quat:E.quaternion.clone(),scale:E.scale.clone(),margin:x},T.push(I)}}),T.length===0){const E=this.prepareThreeObjectForCollisionShape(t,s),R=this.createCollisionShape(E.shape,E.params,E.object);T.push(R)}const D=T.length===1?T[0]:this.mergeCollisionShapesToCompoundShape(T),k=this.applyPosQuatScaleMargin(D,n,i,o,x),P=this.collisionShapeToRigidBody(D,k,l,r);this.addRigidBodyToWorld(t,P,d,f,g,b),t.body.breakable=y,t.body.fractureImpulse=A,t.body.ignoreScale=S}addRigidBodyToWorld(t,s,e,n,i,o){this.rigidBodies.push(t),this.physicsWorld.addRigidBody(s,n,i);const a=Object.values(s)[0];t.name||(t.name=`object-${t.id}`),s.name=t.name,t.body=new Ln(this,s),t.hasBody=!0,t.ptr=a,s.threeObject=t,o&&(t.body.offset={x:0,y:0,z:0,...o}),t.body.setCollisionFlags(e)}applyPosQuatScaleMargin(t,s=new C,e=new j,n=new C,i=.01){t.setMargin(i);const o=new Ammo.btQuaternion(0,0,0,1);o.setValue(e.x,e.y,e.z,e.w);const a=new Ammo.btTransform;a.setIdentity(),a.getOrigin().setValue(s.x,s.y,s.z),a.setRotation(o),Ammo.destroy(o);const r=new Ammo.btVector3(n.x,n.y,n.z);return t.setLocalScaling(r),Ammo.destroy(r),a}collisionShapeToRigidBody(t,s,e,n){const i=new Ammo.btDefaultMotionState(s),o=new Ammo.btVector3(0,0,0);e>0&&t.calculateLocalInertia(e,o);const a=new Ammo.btRigidBodyConstructionInfo(e,i,t,o),r=new Ammo.btRigidBody(a);return(e>0||n)&&r.setActivationState(4),r}}const Pn={style:{position:"relative",height:"400px"}},Nn=de("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",display:"flex","align-items":"center","justify-content":"center"}},[de("div",{style:{background:"#ffffff",padding:"10px 20px"}},"Loading")],-1),Vn={style:{position:"absolute",bottom:"0",right:"0"}},Hn={__name:"scene-gltf",props:{scene:{type:String,default:""},scripts:{type:Array,default:()=>[]}},setup(m){const t=m;console.clear();const s=Bs(null);let e={reactive:We({ready:!1,width:0,height:0,frame:0}),global:We({}),el:null,scene:!1,camera:!1,clock:!1,renderer:!1,scripts:{},events:[],THREE:!1,getScriptInstance(n,i={}){const o=new(e.scripts[n]?e.scripts[n]:class{});o.keyboard={},o.input={},o.motor=e;for(let a in i)o[a]=o[a]||i[a];return o},sceneTraverseMethod(n,i=null){e.scene.traverse(o=>{Array.isArray(o.userData.scripts)&&o.userData.scripts.map(a=>{typeof a[n]=="function"&&a[n](i)})})},onMounted(){In("/assets/ammo",()=>{e.el=s.value,e.reactive.width=e.el.offsetWidth,e.reactive.height=e.el.offsetHeight,e.scene=new Ms,e.camera=new ft(50,e.reactive.width/e.reactive.height,1,1e3),e.clock=new Ls,e.physics=new kn(e.scene),e.physics.debug.enable(),e.physics.debug.mode(1),e.renderer=new Rs({antialias:!0}),e.reactive.frame=0,e.THREE=_s,e.el.appendChild(e.renderer.domElement),e.renderer.setSize(e.reactive.width,e.reactive.height),e.events.push([window,"resize",n=>{e.reactive.width=e.el.offsetWidth,e.reactive.height=e.el.offsetHeight,e.renderer.setSize(e.reactive.width,e.reactive.height)}]),t.scripts.map(n=>{e.scripts[n.name]=n}),new js().load(t.scene,n=>{if(e.scene.userData.scripts=[],e.scripts.SceneScript){const i=e.getScriptInstance("SceneScript",{orbitControls:!1,gridHelper:!1,physicsDebug:!1,scene:e.scene});if(i.orbitControls&&(i.orbitControls=new Mn(e.camera,e.renderer.domElement),e.camera.position.set(0,20,100)),i.gridHelper){const o=Array.isArray(i.gridHelper)?i.gridHelper:[10,10];i.gridHelper=new Cs(o[0],o[1]),e.scene.add(i.gridHelper)}i.physicsDebug&&e.physics.debug,e.scene.userData.scripts.push(i)}e.scene.add(n.scene),n.scene.traverse(i=>{["script0","script1","script2","script3","script4","script5","script6","script7","script8","script9"].map(o=>{if(i.userData[o]){i.userData.scripts=[];const a=e.getScriptInstance(i.userData[o],{object:i});i.userData.scripts.push(a),delete i.userData[o],e.events.push([document,"keydown",r=>{a.keyboard[r.key]=!0,typeof a.onInput=="function"&&(a.input=a.onInput(a.keyboard))}]),e.events.push([document,"keyup",r=>{delete a.keyboard[r.key],typeof a.onInput=="function"&&(a.input=a.onInput(a.keyboard))}])}})}),e.reactive.ready=!0,window.sceneInterval&&clearInterval(window.sceneInterval),e.sceneTraverseMethod("onCreate"),window.sceneInterval=setInterval(()=>{e.scene.userData.scripts.map(i=>{i.orbitControls&&i.orbitControls.update(),i.physicsDebug&&e.physics.updateDebugger()}),e.sceneTraverseMethod("onUpdate"),e.physics.update(e.clock.getDelta()*1e3),e.renderer.render(e.scene,e.camera),e.reactive.frame++},1e3/60),e.events.map(([i,o,a])=>{i.addEventListener(o,a)})})})},onUnmounted(){e.events.map(([n,i,o])=>{n.removeEventListener(i,o)})}};return Fs(e.onMounted),Hs(e.onUnmounted),(n,i)=>(Us(),zs("div",Pn,[de("div",{ref_key:"gameRef",ref:s,style:{height:"100%"}},null,512),be(e).reactive.ready?Ye("",!0):Xe(n.$slots,"loading",{key:0},()=>[Nn]),be(e).reactive.ready?Xe(n.$slots,"content",{key:1},()=>[Gs("Content")]):Ye("",!0),de("pre",Vn,"motor.global: "+Ks(be(e).global),1)]))}};export{In as P,Hn as _};
