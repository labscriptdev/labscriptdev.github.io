import{p as Q,d as O,s as X,D as M,a as Z,S as j,b as F,c as I}from"./styles-f626f8de.711ea325.js";import{G as tt}from"./layout.07d4e07f.js";import{l,c as m,i as $,z as et,j as ot,k as R}from"./index.995ab903.js";import{r as st}from"./index-4c4adb72.a4677724.js";import"./entry.2c083d03.js";import"./index.c7a941bd.js";import"./index.d0e39486.js";import"./index.91336184.js";import"./index.0d90c395.js";import"./Bookapp.ab6c422f.js";import"./Calculator.266d9ea7.js";import"./index.6b466124.js";import"./info.1e4bb3a9.js";import"./info.66f5a8a6.js";import"./three.module.8fae685a.js";import"./matter.fde04bf7.js";import"./scene-gltf.a0ddc4a0.js";import"./index.80f58acf.js";import"./index.3a61fd70.js";import"./index.7a326989.js";import"./index.b8d1a0b3.js";import"./index.7b5b2137.js";import"./index.697a8e40.js";import"./index.eacdf2b6.js";import"./___vite-browser-external.8f066153.js";import"./index.c7eca150.js";import"./index.67a65277.js";import"./index.990633ad.js";import"./info.72a08ec4.js";import"./info.bfb3dcff.js";import"./info.78333159.js";import"./info.72d8a16d.js";import"./info.71ed9620.js";import"./info.a88b74e6.js";import"./alert.0618cca2.js";import"./index.d278d699.js";import"https://cdn.skypack.dev/dat.gui@0.7.9";import"./index.dab0189b.js";import"./edges-b00f0ec2.15eda20f.js";import"./createText-285e50b4.2bd44d27.js";import"./svgDraw-5d8a058e.97c6fdb2.js";import"./line.fe2b3719.js";import"./array.9f3ba611.js";import"./path.53f90ab3.js";const h="rect",x="rectWithTitle",nt="start",it="end",rt="divider",ct="roundedWithTitle",lt="note",at="noteGroup",_="statediagram",pt="state",dt=`${_}-${pt}`,H="transition",Et="note",St="note-edge",Tt=`${H} ${St}`,_t=`${_}-${Et}`,ut="cluster",Dt=`${_}-${ut}`,ft="cluster-alt",bt=`${_}-${ft}`,U="parent",V="note",At="state",G="----",ht=`${G}${V}`,B=`${G}${U}`,Y="fill:none",z="fill: #333",W="c",q="text",K="normal";let y={},d=0;const yt=function(t){const n=Object.keys(t);for(const e of n)t[e]},mt=function(t,n){l.trace("Extracting classes"),n.db.clear();try{return n.parser.parse(t),n.db.extract(n.db.getRootDocV2()),n.db.getClasses()}catch(e){return e}};function gt(t){return t==null?"":t.classes?t.classes.join(" "):""}function C(t="",n=0,e="",i=G){const r=e!==null&&e.length>0?`${i}${e}`:"";return`${At}-${t}${r}-${n}`}const A=(t,n,e,i,r,c)=>{const o=e.id,u=gt(i[o]);if(o!=="root"){let S=h;e.start===!0&&(S=nt),e.start===!1&&(S=it),e.type!==M&&(S=e.type),y[o]||(y[o]={id:o,shape:S,description:R.sanitizeText(o,m()),classes:`${u} ${dt}`});const s=y[o];e.description&&(Array.isArray(s.description)?(s.shape=x,s.description.push(e.description)):s.description.length>0?(s.shape=x,s.description===o?s.description=[e.description]:s.description=[s.description,e.description]):(s.shape=h,s.description=e.description),s.description=R.sanitizeTextOrArray(s.description,m())),s.description.length===1&&s.shape===x&&(s.shape=h),!s.type&&e.doc&&(l.info("Setting cluster for ",o,w(e)),s.type="group",s.dir=w(e),s.shape=e.type===Z?rt:ct,s.classes=s.classes+" "+Dt+" "+(c?bt:""));const T={labelStyle:"",shape:s.shape,labelText:s.description,classes:s.classes,style:"",id:o,dir:s.dir,domId:C(o,d),type:s.type,padding:15};if(T.centerLabel=!0,e.note){const a={labelStyle:"",shape:lt,labelText:e.note.text,classes:_t,style:"",id:o+ht+"-"+d,domId:C(o,d,V),type:s.type,padding:15},p={labelStyle:"",shape:at,labelText:e.note.text,classes:s.classes,style:"",id:o+B,domId:C(o,d,U),type:"group",padding:0};d++;const D=o+B;t.setNode(D,p),t.setNode(a.id,a),t.setNode(o,T),t.setParent(o,D),t.setParent(a.id,D);let E=o,f=a.id;e.note.position==="left of"&&(E=a.id,f=o),t.setEdge(E,f,{arrowhead:"none",arrowType:"",style:Y,labelStyle:"",classes:Tt,arrowheadStyle:z,labelpos:W,labelType:q,thickness:K})}else t.setNode(o,T)}n&&n.id!=="root"&&(l.trace("Setting node ",o," to be child of its parent ",n.id),t.setParent(o,n.id)),e.doc&&(l.trace("Adding nodes children "),$t(t,e,e.doc,i,r,!c))},$t=(t,n,e,i,r,c)=>{l.trace("items",e),e.forEach(o=>{switch(o.stmt){case F:A(t,n,o,i,r,c);break;case M:A(t,n,o,i,r,c);break;case j:{A(t,n,o.state1,i,r,c),A(t,n,o.state2,i,r,c);const u={id:"edge"+d,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:Y,labelStyle:"",label:R.sanitizeText(o.description,m()),arrowheadStyle:z,labelpos:W,labelType:q,thickness:K,classes:H};t.setEdge(o.state1.id,o.state2.id,u,d),d++}break}})},w=(t,n=I)=>{let e=n;if(t.doc)for(let i=0;i<t.doc.length;i++){const r=t.doc[i];r.stmt==="dir"&&(e=r.value)}return e},xt=async function(t,n,e,i){l.info("Drawing state diagram (v2)",n),y={},i.db.getDirection();const{securityLevel:r,state:c}=m(),o=c.nodeSpacing||50,u=c.rankSpacing||50;l.info(i.db.getRootDocV2()),i.db.extract(i.db.getRootDocV2()),l.info(i.db.getRootDocV2());const S=i.db.getStates(),s=new tt({multigraph:!0,compound:!0}).setGraph({rankdir:w(i.db.getRootDocV2()),nodesep:o,ranksep:u,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});A(s,void 0,i.db.getRootDocV2(),S,i.db,!0);let T;r==="sandbox"&&(T=$("#i"+n));const a=r==="sandbox"?$(T.nodes()[0].contentDocument.body):$("body"),p=a.select(`[id="${n}"]`),D=a.select("#"+n+" g");await st(D,s,["barb"],_,n);const E=8;et.insertTitle(p,"statediagramTitleText",c.titleTopMargin,i.db.getDiagramTitle());const f=p.node().getBBox(),N=f.width+E*2,L=f.height+E*2;p.attr("class",_);const P=p.node().getBBox();ot(p,L,N,c.useMaxWidth);const k=`${P.x-E} ${P.y-E} ${N} ${L}`;l.debug(`viewBox ${k}`),p.attr("viewBox",k);const J=document.querySelectorAll('[id="'+n+'"] .edgeLabel .label');for(const g of J){const v=g.getBBox(),b=document.createElementNS("http://www.w3.org/2000/svg",h);b.setAttribute("rx",0),b.setAttribute("ry",0),b.setAttribute("width",v.width),b.setAttribute("height",v.height),g.insertBefore(b,g.firstChild)}},Ct={setConf:yt,getClasses:mt,draw:xt},fe={parser:Q,db:O,renderer:Ct,styles:X,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,O.clear()}};export{fe as diagram};
