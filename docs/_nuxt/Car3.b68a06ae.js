import{E as l}from"./matter.88d35005.js";import"./three.module.2ad6d296.js";import"./entry.5d33167f.js";class x extends l{constructor(o){super(),this.name="Car",this.game=o.game,this.x=o.x||0,this.y=o.y||0,this.z=o.z||0}onCreate(){const{camera:o}=this.game.getData(),{x:i,y:t,z:e}=this;this.position.set(i,t,e),console.log("position",{x:i,y:t,z:e}),this.carCreate(),this.plate.add(o),o.position.y=2,o.position.z=8}onUpdate(){this.carControls()}carCreate(){const{physics:o,scene:i}=this.game.getData(),{x:t,y:e,z:s}=this,r=1.5,a=2,n=.2;this.wheelBackRight=this.addWheel(t+r,s+a),this.wheelBackLeft=this.addWheel(t-r,s+a),this.wheelFrontRight=this.addWheel(t+r,s-a),this.wheelFrontLeft=this.addWheel(t-r,s-a),this.rotorBackRight=this.addRotor(t+r,s+a),this.rotorBackLeft=this.addRotor(t-r,s+a),this.rotorFrontRight=this.addRotor(t+r,s-a),this.rotorFrontLeft=this.addRotor(t-r,s-a),this.axisBackOne=this.addAxis(s+a,.4),this.axisFrontOne=this.addAxis(s-a+n,.4),this.axisFrontTwo=this.addAxis(s-a-n);const h={axisA:{y:1},axisB:{y:1}};this.motorBackLeft=o.add.constraints.hinge(this.wheelBackLeft.body,this.rotorBackLeft.body,h),this.motorBackRight=o.add.constraints.hinge(this.wheelBackRight.body,this.rotorBackRight.body,h),this.motorFrontLeft=o.add.constraints.hinge(this.wheelFrontLeft.body,this.rotorFrontLeft.body,h),this.motorFrontRight=o.add.constraints.hinge(this.wheelFrontRight.body,this.rotorFrontRight.body,h),o.add.constraints.lock(this.rotorBackRight.body,this.axisBackOne.body),o.add.constraints.lock(this.rotorBackLeft.body,this.axisBackOne.body),this.m0=this.axisToRotor(this.rotorFrontRight,this.rotorFrontLeft,this.axisFrontTwo,-0),this.axisToRotor(this.rotorFrontRight,this.rotorFrontLeft,this.axisFrontOne,.4),this.plate=this.addPlate(),o.add.constraints.lock(this.plate.body,this.axisBackOne.body),o.add.constraints.lock(this.plate.body,this.axisFrontTwo.body);const d=.3,c={angularLowerLimit:{x:0,y:0,z:0},angularUpperLimit:{x:0,y:0,z:0},linearLowerLimit:{x:0,y:-d,z:-.1},linearUpperLimit:{x:0,y:d,z:.1}};o.add.constraints.dof(this.plate.body,this.axisFrontOne.body,{...c,offset:{y:.9}}),o.add.constraints.dof(this.plate.body,this.axisFrontOne.body,{...c,offset:{y:-.9}}),this.m0.left.enableAngularMotor(!0,0,1e3),this.m0.right.enableAngularMotor(!0,0,1e3)}carControls(){const{input:o}=this.game.getData(),i=40;let t=0;o.w?(t=2,this.motorBackLeft.enableAngularMotor(!0,-i,t),this.motorBackRight.enableAngularMotor(!0,-i,t),this.motorFrontLeft.enableAngularMotor(!0,-i,t),this.motorFrontRight.enableAngularMotor(!0,-i,t)):o.s?(t=.9,this.motorBackLeft.enableAngularMotor(!0,i,t),this.motorBackRight.enableAngularMotor(!0,i,t),this.motorFrontLeft.enableAngularMotor(!0,i,t),this.motorFrontRight.enableAngularMotor(!0,i,t)):(t=.05,this.motorBackLeft.enableAngularMotor(!0,0,t),this.motorBackRight.enableAngularMotor(!0,0,t),this.motorFrontLeft.enableAngularMotor(!0,0,t),this.motorFrontRight.enableAngularMotor(!0,0,t));const e=.4;o.a?(this.m0.left.setMotorTarget(-e,.5),this.m0.right.setMotorTarget(-e,.5)):o.d?(this.m0.left.setMotorTarget(e,.5),this.m0.right.setMotorTarget(e,.5)):(this.m0.left.setMotorTarget(0,.5),this.m0.right.setMotorTarget(0,.5))}addWheel(o,i){const{physics:t}=this.game.getData(),{y:e}=this,s=t.factory.add.cylinder({x:o,y:e,z:i,radiusBottom:.5,radiusTop:.5,radiusSegments:24,height:.35},{lambert:{color:"blue",transparent:!0,opacity:.5}});return this.add(s),s.rotateZ(Math.PI/2),t.add.existing(s,{mass:20}),s.body.setFriction(3),s}addRotor(o,i){const{physics:t}=this.game.getData(),{y:e}=this,s=t.factory.add.cylinder({x:o,y:e,z:i,radiusBottom:.35,radiusTop:.35,radiusSegments:24,height:.4},{lambert:{color:"red",transparent:!0,opacity:.5}});return this.add(s),s.rotateZ(Math.PI/2),t.add.existing(s,{mass:10}),s}addAxis(o,i=.06){const{physics:t}=this.game.getData(),{x:e,y:s}=this,r=t.factory.add.cylinder({x:e,y:s,z:o,mass:10,radiusTop:i,radiusBottom:i,height:2.6},{lambert:{color:"blue",transparent:!0,opacity:.5}});return this.add(r),r.rotateZ(Math.PI/2),t.add.existing(r),r}axisToRotor(o,i,t,e){const{physics:s}=this.game.getData(),r=s.add.constraints.hinge(o.body,t.body,{pivotA:{y:.2,z:e},pivotB:{y:-1.3},axisA:{x:1},axisB:{x:1}}),a=s.add.constraints.hinge(i.body,t.body,{pivotA:{y:-.2,z:e},pivotB:{y:1.3},axisA:{x:1},axisB:{x:1}});return{right:r,left:a}}addPlate(){const{physics:o}=this.game.getData(),{x:i,y:t,z:e}=this.position,s=o.factory.add.box({x:i,y:t,z:e,width:1.8,depth:4.7,mass:5e3,height:.25},{lambert:{wireframe:!0}});return this.add(s),o.add.existing(s),s}}export{x as default};
